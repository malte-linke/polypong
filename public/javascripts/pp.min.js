/*
  Packed with Packk v1.0.3 by tensoid
  https://github.com/tensoid/packk
*/

/*
Fully packaged source code of polypong.
*/

(() => {class ParticleEmitter{constructor(e,t={}){this.canvas=e,this.ctx=e.getContext("2d"),this.particles=[],this.particleLifeTime=t.particleLifeTime||100,this.maxParticles=t.maxParticles||100,this.particleSizeStart=t.particleSizeStart||5,this.particleSizeEnd=t.particleSizeEnd||5,this.particleColorStart=t.particleColorStart||{r:255,g:255,b:255,a:255},this.particleColorEnd=t.particleColorEnd||{r:255,g:255,b:255,a:255},this.particleSpeedStart=t.particleSpeedStart||1,this.particleSpeedEnd=t.particleSpeedEnd||1,this.particleDirection=t.particleDirection||0,this.particleSpread=t.particleSpread||0,this.emitterSize=t.emitterSize||1,this.emitterSpeed=t.emitterSpeed||1,this.emitterPosition=t.emitterPosition||{x:300,y:300},this.lastParticle=Date.now()}createParticle(){var e={x:0,y:-this.particleSpeedStart},e=this.#Vec2.rotate(e,this.particleDirection),t=(e=this.#Vec2.rotate(e,Math.random()*this.particleSpread-this.particleSpread/2),this.emitterSize*Math.sqrt(Math.random())),n=2*Math.random()*Math.PI,o=this.emitterPosition.x+t*Math.cos(n),t=this.emitterPosition.y+t*Math.sin(n);this.particles.push({lifeTime:this.particleLifeTime,velocity:{x:e.x,y:e.y},position:{x:o,y:t},size:this.particleSizeStart,color:this.particleColorStart})}update(){this.particles.length<this.maxParticles&&Date.now()-this.lastParticle>this.emitterSpeed&&(this.createParticle(),this.lastParticle=Date.now()),this.particles.forEach((e,t)=>{e.lifeTime<=0&&this.particles.splice(t,1),e.size=this.particleSizeStart+(this.particleSizeEnd-this.particleSizeStart)*(this.particleLifeTime-e.lifeTime)/this.particleLifeTime;var t=this.#Vec2.getAngle(e.velocity,{x:0,y:-1}),n=this.particleSpeedStart+(this.particleSpeedEnd-this.particleSpeedStart)*(this.particleLifeTime-e.lifeTime)/this.particleLifeTime;e.velocity={x:0,y:-n},e.velocity=this.#Vec2.rotate(e.velocity,-t),e.color=this.#Color.rgbaFade(this.particleColorStart,this.particleColorEnd,(this.particleLifeTime-e.lifeTime)/this.particleLifeTime),e.position.x+=e.velocity.x,e.position.y+=e.velocity.y,--e.lifeTime})}draw(){this.particles.forEach(e=>{this.ctx.beginPath(),this.ctx.fillStyle=`rgba(
          ${e.color.r},
          ${e.color.g},
          ${e.color.b},
          ${e.color.a/255}
        )`,this.ctx.arc(e.position.x,e.position.y,e.size,0,2*Math.PI),this.ctx.fill(),this.ctx.closePath()})}#Vec2={rotate(e,t){return t=t*Math.PI/180,{x:e.x*Math.cos(t)-e.y*Math.sin(t),y:e.x*Math.sin(t)+e.y*Math.cos(t)}},getAngle(e,t){var n=e.x*t.x+e.y*t.y,e=e.x*t.y-e.y*t.x;return 180*Math.atan2(e,n)/Math.PI}};#Color={rgbaFade(e,t,n){return{r:e.r+(t.r-e.r)*n,g:e.g+(t.g-e.g)*n,b:e.b+(t.b-e.b)*n,a:e.a+(t.a-e.a)*n}}}}!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).io=t()}(this,function(){"use strict";function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function e(e,t,n){return t&&l(e.prototype,t),n&&l(e,n),e}function d(){return(d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,o=arguments[t];for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e}).apply(this,arguments)}function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function f(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _(n){var o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=i(n),t=(e=o?(e=i(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return f(t)}}function y(e,t,n){return(y="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var e=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=i(e)););return e}(e,t);if(e)return(e=Object.getOwnPropertyDescriptor(e,t)).get?e.get.call(n):e.value})(e,t,n||e)}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function v(e){var t=e,n=e.indexOf("["),o=e.indexOf("]");-1!=n&&-1!=o&&(e=e.substring(0,n)+e.substring(n,o).replace(/:/g,";")+e.substring(o,e.length));for(var r,i=g.exec(e||""),s={},a=14;a--;)s[b[a]]=i[a]||"";return-1!=n&&-1!=o&&(s.source=t,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=(e=s.path,n=e.replace(/\/{2,9}/g,"/").split("/"),"/"!=e.substr(0,1)&&0!==e.length||n.splice(0,1),"/"==e.substr(e.length-1,1)&&n.splice(n.length-1,1),n),s.queryKey=(o=s.query,r={},o.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(e,t,n){t&&(r[t]=n)}),r),s}var g=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,b=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],t={exports:{}};try{t.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(c){t.exports=!1}var x=t.exports,w="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function k(e){var t=e.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!t||x))return new XMLHttpRequest}catch(e){}if(!t)try{return new w[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch(e){}}function A(n){for(var e=arguments.length,t=new Array(1<e?e-1:0),o=1;o<e;o++)t[o-1]=arguments[o];return t.reduce(function(e,t){return n.hasOwnProperty(t)&&(e[t]=n[t]),e},{})}var T=setTimeout,S=clearTimeout;function P(e,t){t.useNativeTimers?(e.setTimeoutFn=T.bind(w),e.clearTimeoutFn=S.bind(w)):(e.setTimeoutFn=setTimeout.bind(w),e.clearTimeoutFn=clearTimeout.bind(w))}t=o;function o(e){if(e){var t,n=e;for(t in o.prototype)n[t]=o.prototype[t];return n}}o.prototype.on=o.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},o.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},o.prototype.off=o.prototype.removeListener=o.prototype.removeAllListeners=o.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,o=this._callbacks["$"+e];if(!o)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var r=0;r<o.length;r++)if((n=o[r])===t||n.fn===t){o.splice(r,1);break}return 0===o.length&&delete this._callbacks["$"+e],this},o.prototype.emitReserved=o.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),n=this._callbacks["$"+e],o=1;o<arguments.length;o++)t[o-1]=arguments[o];if(n)for(var o=0,r=(n=n.slice(0)).length;o<r;++o)n[o].apply(this,t);return this},o.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},o.prototype.hasListeners=function(e){return!!this.listeners(e).length};var s=Object.create(null),I=(s.open="0",s.close="1",s.ping="2",s.pong="3",s.message="4",s.upgrade="5",s.noop="6",Object.create(null));Object.keys(s).forEach(function(e){I[s[e]]=e});for(var E={type:"error",data:"parser error"},B="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),C="function"==typeof ArrayBuffer,R=function(e,t,n){var o,r=e.type,e=e.data;return B&&e instanceof Blob?t?n(e):O(e,n):C&&(e instanceof ArrayBuffer||(o=e,"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(o):o&&o.buffer instanceof ArrayBuffer))?t?n(e):O(new Blob([e]),n):n(s[r]+(e||""))},O=function(e,t){var n=new FileReader;return n.onload=function(){var e=n.result.split(",")[1];t("b"+e)},n.readAsDataURL(e)},M="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",L="undefined"==typeof Uint8Array?[]:new Uint8Array(256),D=0;D<M.length;D++)L[M.charCodeAt(D)]=D;function V(e,t){if("string"!=typeof e)return{type:"message",data:F(e,t)};var n=e.charAt(0);return"b"===n?{type:"message",data:function(e,t){if(H){var n=function(e){var t,n,o,r,i,s=.75*e.length,l=e.length,a=0;"="===e[e.length-1]&&(s--,"="===e[e.length-2]&&s--);var c=new ArrayBuffer(s),u=new Uint8Array(c);for(t=0;t<l;t+=4)n=L[e.charCodeAt(t)],o=L[e.charCodeAt(t+1)],r=L[e.charCodeAt(t+2)],i=L[e.charCodeAt(t+3)],u[a++]=n<<2|o>>4,u[a++]=(15&o)<<4|r>>2,u[a++]=(3&r)<<6|63&i;return c}(e);return F(n,t)}return{base64:!0,data:e}}(e.substring(1),t)}:I[n]?1<e.length?{type:I[n],data:e.substring(1)}:{type:I[n]}:E}var N,j,H="function"==typeof ArrayBuffer,F=function(e,t){return"blob"===t&&e instanceof ArrayBuffer?new Blob([e]):e},q=String.fromCharCode(30),z=(h(Y,t),j=_(Y),e(Y,[{key:"onError",value:function(e,t){e=new Error(e);return e.type="TransportError",e.description=t,y(i(Y.prototype),"emit",this).call(this,"error",e),this}},{key:"open",value:function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this}},{key:"close",value:function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}},{key:"send",value:function(e){"open"===this.readyState&&this.write(e)}},{key:"onOpen",value:function(){this.readyState="open",this.writable=!0,y(i(Y.prototype),"emit",this).call(this,"open")}},{key:"onData",value:function(e){e=V(e,this.socket.binaryType);this.onPacket(e)}},{key:"onPacket",value:function(e){y(i(Y.prototype),"emit",this).call(this,"packet",e)}},{key:"onClose",value:function(){this.readyState="closed",y(i(Y.prototype),"emit",this).call(this,"close")}}]),Y),G="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),U={},K=0,$=0;function Y(e){var t;return r(this,Y),(t=j.call(this)).writable=!1,P(f(t),e),t.opts=e,t.query=e.query,t.readyState="",t.socket=e.socket,t}function X(e){for(var t="";t=G[e%64]+t,0<(e=Math.floor(e/64)););return t}function W(){var e=X(+new Date);return e!==N?(K=0,N=e):e+"."+X(K++)}for(;$<64;$++)U[G[$]]=$;W.encode=X,W.decode=function(e){var t=0;for($=0;$<e.length;$++)t=64*t+U[e.charAt($)];return t};var J,Q=W,Z=function(e){var t,n="";for(t in e)e.hasOwnProperty(t)&&(n.length&&(n+="&"),n+=encodeURIComponent(t)+"="+encodeURIComponent(e[t]));return n},ee=function(e){for(var t={},n=e.split("&"),o=0,r=n.length;o<r;o++){var i=n[o].split("=");t[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return t},n=(h(te,z),J=_(te),e(te,[{key:"name",get:function(){return"polling"}},{key:"doOpen",value:function(){this.poll()}},{key:"pause",value:function(e){function t(){o.readyState="paused",e()}var n,o=this;this.readyState="pausing";this.polling||!this.writable?(n=0,this.polling&&(n++,this.once("pollComplete",function(){--n||t()})),this.writable||(n++,this.once("drain",function(){--n||t()}))):t()}},{key:"poll",value:function(){this.polling=!0,this.doPoll(),this.emit("poll")}},{key:"onData",value:function(e){var t=this;(function(e,t){for(var n=e.split(q),o=[],r=0;r<n.length;r++){var i=V(n[r],t);if(o.push(i),"error"===i.type)break}return o})(e,this.socket.binaryType).forEach(function(e){if("opening"===t.readyState&&"open"===e.type&&t.onOpen(),"close"===e.type)return t.onClose(),!1;t.onPacket(e)}),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState&&this.poll())}},{key:"doClose",value:function(){function e(){t.write([{type:"close"}])}var t=this;"open"===this.readyState?e():this.once("open",e)}},{key:"write",value:function(e){var n,o,r,i=this;this.writable=!1,n=(e=e).length,o=new Array(n),r=0,e.forEach(function(e,t){R(e,!1,function(e){o[t]=e,++r===n&&(e=o.join(q),i.doWrite(e,function(){i.writable=!0,i.emit("drain")}))})})}},{key:"uri",value:function(){var e=this.query||{},t=this.opts.secure?"https":"http",n="",e=(!1!==this.opts.timestampRequests&&(e[this.opts.timestampParam]=Q()),this.supportsBinary||e.sid||(e.b64=1),this.opts.port&&("https"==t&&443!==Number(this.opts.port)||"http"==t&&80!==Number(this.opts.port))&&(n=":"+this.opts.port),Z(e));return t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+(e.length?"?"+e:"")}}]),te);function te(){var e;return r(this,te),(e=J.apply(this,arguments)).polling=!1,e}function ne(){}var oe,re,ie=null!=new k({xdomain:!1}).responseType,n=(h(ce,n),re=_(ce),e(ce,[{key:"request",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return d(e,{xd:this.xd,xs:this.xs},this.opts),new se(this.uri(),e)}},{key:"doWrite",value:function(e,t){var n=this,e=this.request({method:"POST",data:e});e.on("success",t),e.on("error",function(e){n.onError("xhr post error",e)})}},{key:"doPoll",value:function(){var t=this,e=this.request();e.on("data",this.onData.bind(this)),e.on("error",function(e){t.onError("xhr poll error",e)}),this.pollXhr=e}}]),ce),se=(h(ae,t),oe=_(ae),e(ae,[{key:"create",value:function(){var e=this,t=A(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref"),n=(t.xdomain=!!this.opts.xd,t.xscheme=!!this.opts.xs,this.xhr=new k(t));try{n.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders)for(var o in n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0),this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(o)&&n.setRequestHeader(o,this.opts.extraHeaders[o])}catch(e){}if("POST"===this.method)try{n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{n.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in n&&(n.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(n.timeout=this.opts.requestTimeout),n.onreadystatechange=function(){4===n.readyState&&(200===n.status||1223===n.status?e.onLoad():e.setTimeoutFn(function(){e.onError("number"==typeof n.status?n.status:0)},0))},n.send(this.data)}catch(t){return void this.setTimeoutFn(function(){e.onError(t)},0)}"undefined"!=typeof document&&(this.index=ae.requestsCount++,ae.requests[this.index]=this)}},{key:"onSuccess",value:function(){this.emit("success"),this.cleanup()}},{key:"onData",value:function(e){this.emit("data",e),this.onSuccess()}},{key:"onError",value:function(e){this.emit("error",e),this.cleanup(!0)}},{key:"cleanup",value:function(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=ne,e)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete ae.requests[this.index],this.xhr=null}}},{key:"onLoad",value:function(){var e=this.xhr.responseText;null!==e&&this.onData(e)}},{key:"abort",value:function(){this.cleanup()}}]),ae);function ae(e,t){var n;return r(this,ae),P(f(n=oe.call(this)),t),n.opts=t,n.method=t.method||"GET",n.uri=e,n.async=!1!==t.async,n.data=void 0!==t.data?t.data:null,n.create(),n}function ce(e){r(this,ce),t=re.call(this,e),"undefined"!=typeof location&&(n="https:"===location.protocol,o=(o=location.port)||(n?"443":"80"),t.xd="undefined"!=typeof location&&e.hostname!==location.hostname||o!==e.port,t.xs=e.secure!==n);var t,n,o=e&&e.forceBase64;return t.supportsBinary=ie&&!o,t}function ue(){for(var e in se.requests)se.requests.hasOwnProperty(e)&&se.requests[e].abort()}se.requestsCount=0,se.requests={},"undefined"!=typeof document&&("function"==typeof attachEvent?attachEvent("onunload",ue):"function"==typeof addEventListener&&addEventListener("onpagehide"in w?"pagehide":"unload",ue,!1));var le="function"==typeof Promise&&"function"==typeof Promise.resolve?function(e){return Promise.resolve().then(e)}:function(e,t){return t(e,0)},de=w.WebSocket||w.MozWebSocket,he="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();h(ve,z),fe=_(ve),e(ve,[{key:"name",get:function(){return"websocket"}},{key:"doOpen",value:function(){if(this.check()){var e=this.uri(),t=this.opts.protocols,n=he?{}:A(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=he?new de(e,t,n):t?new de(e,t):new de(e)}catch(e){return this.emit("error",e)}this.ws.binaryType=this.socket.binaryType||"arraybuffer",this.addEventListeners()}}},{key:"addEventListeners",value:function(){var t=this;this.ws.onopen=function(){t.opts.autoUnref&&t.ws._socket.unref(),t.onOpen()},this.ws.onclose=this.onClose.bind(this),this.ws.onmessage=function(e){return t.onData(e.data)},this.ws.onerror=function(e){return t.onError("websocket error",e)}}},{key:"write",value:function(o){var r=this;this.writable=!1;for(var e=0;e<o.length;e++)!function(e){var t=o[e],n=e===o.length-1;R(t,r.supportsBinary,function(e){try{r.ws.send(e)}catch(e){}n&&le(function(){r.writable=!0,r.emit("drain")},r.setTimeoutFn)})}(e)}},{key:"doClose",value:function(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}},{key:"uri",value:function(){var e=this.query||{},t=this.opts.secure?"wss":"ws",n="",e=(this.opts.port&&("wss"==t&&443!==Number(this.opts.port)||"ws"==t&&80!==Number(this.opts.port))&&(n=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=Q()),this.supportsBinary||(e.b64=1),Z(e));return t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+(e.length?"?"+e:"")}},{key:"check",value:function(){return!(!de||"__initialize"in de&&this.name===ve.prototype.name)}}]);var pe,fe,_e={websocket:ve,polling:n},ye=(h(me,t),pe=_(me),e(me,[{key:"createTransport",value:function(e){var t=function(e){var t,n={};for(t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);return n}(this.opts.query),t=(t.EIO=4,t.transport=e,this.id&&(t.sid=this.id),d({},this.opts.transportOptions[e],this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port}));return new _e[e](t)}},{key:"open",value:function(){var e,t=this;if(this.opts.rememberUpgrade&&me.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn(function(){t.emitReserved("error","No transports available")},0);e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)}},{key:"setTransport",value:function(e){var t=this;this.transport&&this.transport.removeAllListeners(),(this.transport=e).on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",function(){t.onClose("transport close")})}},{key:"probe",value:function(l){var t=this,n=this.createTransport(l),o=!1,e=(me.priorWebsocketSuccess=!1,function(){o||(n.send([{type:"ping",data:"probe"}]),n.once("packet",function(e){o||("pong"===e.type&&"probe"===e.data?(t.upgrading=!0,t.emitReserved("upgrading",n),n&&(me.priorWebsocketSuccess="websocket"===n.name,t.transport.pause(function(){o||"closed"!==t.readyState&&(u(),t.setTransport(n),n.send([{type:"upgrade"}]),t.emitReserved("upgrade",n),n=null,t.upgrading=!1,t.flush())}))):((e=new Error("probe error")).transport=n.name,t.emitReserved("upgradeError",e)))}))});function r(){o||(o=!0,u(),n.close(),n=null)}var i=function(e){e=new Error("probe error: "+e);e.transport=n.name,r(),t.emitReserved("upgradeError",e)};function s(){i("transport closed")}function a(){i("socket closed")}function c(e){n&&e.name!==n.name&&r()}var u=function(){n.removeListener("open",e),n.removeListener("error",i),n.removeListener("close",s),t.off("close",a),t.off("upgrading",c)};n.once("open",e),n.once("error",i),n.once("close",s),this.once("close",a),this.once("upgrading",c),n.open()}},{key:"onOpen",value:function(){if(this.readyState="open",me.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade&&this.transport.pause)for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},{key:"onPacket",value:function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}},{key:"onHandshake",value:function(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}},{key:"resetPingTimeout",value:function(){var e=this;this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(function(){e.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}},{key:"onDrain",value:function(){this.writeBuffer.splice(0,this.prevBufferLen),(this.prevBufferLen=0)===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}},{key:"flush",value:function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emitReserved("flush"))}},{key:"write",value:function(e,t,n){return this.sendPacket("message",e,t,n),this}},{key:"send",value:function(e,t,n){return this.sendPacket("message",e,t,n),this}},{key:"sendPacket",value:function(e,t,n,o){"function"==typeof t&&(o=t,t=void 0),"function"==typeof n&&(o=n,n=null),"closing"!==this.readyState&&"closed"!==this.readyState&&((n=n||{}).compress=!1!==n.compress,this.emitReserved("packetCreate",e={type:e,data:t,options:n}),this.writeBuffer.push(e),o&&this.once("flush",o),this.flush())}},{key:"close",value:function(){function e(){n.off("upgrade",e),n.off("upgradeError",e),o()}function t(){n.once("upgrade",e),n.once("upgradeError",e)}var n=this,o=function(){n.onClose("forced close"),n.transport.close()};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",function(){(n.upgrading?t:o)()}):(this.upgrading?t:o)()),this}},{key:"onError",value:function(e){me.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}},{key:"onClose",value:function(e,t){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&removeEventListener("offline",this.offlineEventListener,!1),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}},{key:"filterUpgrades",value:function(e){for(var t=[],n=0,o=e.length;n<o;n++)~this.transports.indexOf(e[n])&&t.push(e[n]);return t}}]),me);function me(e){var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return r(this,me),t=pe.call(this),e&&"object"===c(e)&&(n=e,e=null),e?(e=v(e),n.hostname=e.host,n.secure="https"===e.protocol||"wss"===e.protocol,n.port=e.port,e.query&&(n.query=e.query)):n.host&&(n.hostname=v(n.host).host),P(f(t),n),t.secure=null!=n.secure?n.secure:"undefined"!=typeof location&&"https:"===location.protocol,n.hostname&&!n.port&&(n.port=t.secure?"443":"80"),t.hostname=n.hostname||("undefined"!=typeof location?location.hostname:"localhost"),t.port=n.port||("undefined"!=typeof location&&location.port?location.port:t.secure?"443":"80"),t.transports=n.transports||["polling","websocket"],t.readyState="",t.writeBuffer=[],t.prevBufferLen=0,t.opts=d({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},n),t.opts.path=t.opts.path.replace(/\/$/,"")+"/","string"==typeof t.opts.query&&(t.opts.query=ee(t.opts.query)),t.id=null,t.upgrades=null,t.pingInterval=null,t.pingTimeout=null,t.pingTimeoutTimer=null,"function"==typeof addEventListener&&(t.opts.closeOnBeforeunload&&addEventListener("beforeunload",function(){t.transport&&(t.transport.removeAllListeners(),t.transport.close())},!1),"localhost"!==t.hostname&&(t.offlineEventListener=function(){t.onClose("transport close")},addEventListener("offline",t.offlineEventListener,!1))),t.open(),t}function ve(e){var t;return r(this,ve),(t=fe.call(this,e)).supportsBinary=!e.forceBase64,t}ye.protocol=4;var a,ge="function"==typeof ArrayBuffer,z=Object.prototype.toString,be="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===z.call(Blob),xe="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===z.call(File);function we(e){return ge&&(e instanceof ArrayBuffer||(t=e,"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer))||be&&e instanceof Blob||xe&&e instanceof File;var t}function ke(e){var t=[],n=e.data;return e.data=function e(t,n){if(!t)return t;{var o;if(we(t))return o={_placeholder:!0,num:n.length},n.push(t),o}if(Array.isArray(t)){for(var r=new Array(t.length),i=0;i<t.length;i++)r[i]=e(t[i],n);return r}if("object"===c(t)&&!(t instanceof Date)){var s,a={};for(s in t)t.hasOwnProperty(s)&&(a[s]=e(t[s],n));return a}return t}(n,t),e.attachments=t.length,{packet:e,buffers:t}}function Ae(e,t){return e.data=function e(t,n){if(!t)return t;if(t&&t._placeholder)return n[t.num];if(Array.isArray(t))for(var o=0;o<t.length;o++)t[o]=e(t[o],n);else if("object"===c(t))for(var r in t)t.hasOwnProperty(r)&&(t[r]=e(t[r],n));return t}(e.data,t),e.attachments=void 0,e}(n=a=a||{})[n.CONNECT=0]="CONNECT",n[n.DISCONNECT=1]="DISCONNECT",n[n.EVENT=2]="EVENT",n[n.ACK=3]="ACK",n[n.CONNECT_ERROR=4]="CONNECT_ERROR",n[n.BINARY_EVENT=5]="BINARY_EVENT",n[n.BINARY_ACK=6]="BINARY_ACK";e(Pe,[{key:"encode",value:function(e){return e.type!==a.EVENT&&e.type!==a.ACK||!function e(t){if(!t||"object"!==c(t))return!1;if(Array.isArray(t)){for(var n=0,o=t.length;n<o;n++)if(e(t[n]))return!0;return!1}if(we(t))return!0;if(t.toJSON&&"function"==typeof t.toJSON&&1===arguments.length)return e(t.toJSON(),!0);for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)&&e(t[r]))return!0;return!1}(e)?[this.encodeAsString(e)]:(e.type=e.type===a.EVENT?a.BINARY_EVENT:a.BINARY_ACK,this.encodeAsBinary(e))}},{key:"encodeAsString",value:function(e){var t=""+e.type;return e.type!==a.BINARY_EVENT&&e.type!==a.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data)),t}},{key:"encodeAsBinary",value:function(e){var e=ke(e),t=this.encodeAsString(e.packet),e=e.buffers;return e.unshift(t),e}}]);var Te,z=Pe,n=(h(Se,t),Te=_(Se),e(Se,[{key:"add",value:function(e){var t;if("string"==typeof e)(t=this.decodeString(e)).type===a.BINARY_EVENT||t.type===a.BINARY_ACK?(this.reconstructor=new Ie(t),0===t.attachments&&y(i(Se.prototype),"emitReserved",this).call(this,"decoded",t)):y(i(Se.prototype),"emitReserved",this).call(this,"decoded",t);else{if(!we(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(t=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,y(i(Se.prototype),"emitReserved",this).call(this,"decoded",t))}}},{key:"decodeString",value:function(e){var t=0,n={type:Number(e.charAt(0))};if(void 0===a[n.type])throw new Error("unknown packet type "+n.type);if(n.type===a.BINARY_EVENT||n.type===a.BINARY_ACK){for(var o=t+1;"-"!==e.charAt(++t)&&t!=e.length;);o=e.substring(o,t);if(o!=Number(o)||"-"!==e.charAt(t))throw new Error("Illegal attachments");n.attachments=Number(o)}if("/"===e.charAt(t+1)){for(o=t+1;++t&&","!==e.charAt(t)&&t!==e.length;);n.nsp=e.substring(o,t)}else n.nsp="/";o=e.charAt(t+1);if(""!==o&&Number(o)==o){for(o=t+1;++t;){var r=e.charAt(t);if(null==r||Number(r)!=r){--t;break}if(t===e.length)break}n.id=Number(e.substring(o,t+1))}if(e.charAt(++t)){o=function(e){try{return JSON.parse(e)}catch(e){return!1}}(e.substr(t));if(!Se.isPayloadValid(n.type,o))throw new Error("invalid payload");n.data=o}return n}},{key:"destroy",value:function(){this.reconstructor&&this.reconstructor.finishedReconstruction()}}],[{key:"isPayloadValid",value:function(e,t){switch(e){case a.CONNECT:return"object"===c(t);case a.DISCONNECT:return void 0===t;case a.CONNECT_ERROR:return"string"==typeof t||"object"===c(t);case a.EVENT:case a.BINARY_EVENT:return Array.isArray(t)&&0<t.length;case a.ACK:case a.BINARY_ACK:return Array.isArray(t)}}}]),Se);function Se(){return r(this,Se),Te.call(this)}function Pe(){r(this,Pe)}e(Be,[{key:"takeBinaryData",value:function(e){return this.buffers.push(e),this.buffers.length===this.reconPack.attachments?(e=Ae(this.reconPack,this.buffers),this.finishedReconstruction(),e):null}},{key:"finishedReconstruction",value:function(){this.reconPack=null,this.buffers=[]}}]);var Ie=Be,Ee=Object.freeze({__proto__:null,protocol:5,get PacketType(){return a},Encoder:z,Decoder:n});function Be(e){r(this,Be),this.packet=e,this.buffers=[],this.reconPack=e}function u(e,t,n){return e.on(t,n),function(){e.off(t,n)}}var Ce,Re=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1}),Oe=(h(Le,t),Ce=_(Le),e(Le,[{key:"subEvents",value:function(){var e;this.subs||(e=this.io,this.subs=[u(e,"open",this.onopen.bind(this)),u(e,"packet",this.onpacket.bind(this)),u(e,"error",this.onerror.bind(this)),u(e,"close",this.onclose.bind(this))])}},{key:"active",get:function(){return!!this.subs}},{key:"connect",value:function(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}},{key:"open",value:function(){return this.connect()}},{key:"send",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.unshift("message"),this.emit.apply(this,t),this}},{key:"emit",value:function(e){if(Re.hasOwnProperty(e))throw new Error('"'+e+'" is a reserved event name');for(var t=arguments.length,n=new Array(1<t?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];n.unshift(e);var r,e={type:a.EVENT,data:n,options:{}},i=(e.options.compress=!1!==this.flags.compress,"function"==typeof n[n.length-1]&&(r=this.ids++,i=n.pop(),this._registerAckCallback(r,i),e.id=r),this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable);return this.flags.volatile&&(!i||!this.connected)||(this.connected?this.packet(e):this.sendBuffer.push(e)),this.flags={},this}},{key:"_registerAckCallback",value:function(t,o){var r,i=this,e=this.flags.timeout;void 0!==e?(r=this.io.setTimeoutFn(function(){delete i.acks[t];for(var e=0;e<i.sendBuffer.length;e++)i.sendBuffer[e].id===t&&i.sendBuffer.splice(e,1);o.call(i,new Error("operation has timed out"))},e),this.acks[t]=function(){i.io.clearTimeoutFn(r);for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];o.apply(i,[null].concat(t))}):this.acks[t]=o}},{key:"packet",value:function(e){e.nsp=this.nsp,this.io._packet(e)}},{key:"onopen",value:function(){var t=this;"function"==typeof this.auth?this.auth(function(e){t.packet({type:a.CONNECT,data:e})}):this.packet({type:a.CONNECT,data:this.auth})}},{key:"onerror",value:function(e){this.connected||this.emitReserved("connect_error",e)}},{key:"onclose",value:function(e){this.connected=!1,this.disconnected=!0,delete this.id,this.emitReserved("disconnect",e)}},{key:"onpacket",value:function(e){if(e.nsp===this.nsp)switch(e.type){case a.CONNECT:e.data&&e.data.sid?(t=e.data.sid,this.onconnect(t)):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case a.EVENT:case a.BINARY_EVENT:this.onevent(e);break;case a.ACK:case a.BINARY_ACK:this.onack(e);break;case a.DISCONNECT:this.ondisconnect();break;case a.CONNECT_ERROR:this.destroy();var t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t)}}},{key:"onevent",value:function(e){var t=e.data||[];null!=e.id&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}},{key:"emitEvent",value:function(e){if(this._anyListeners&&this._anyListeners.length){var t,n=function(e,t){var n,o="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!o){if(Array.isArray(e)||(o=function(e){if(e){if("string"==typeof e)return m(e,void 0);var t=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(t="Object"===t&&e.constructor?e.constructor.name:t)||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?m(e,void 0):void 0}}(e))||t&&e&&"number"==typeof e.length)return o&&(e=o),n=0,{s:t=function(){},n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i=!0,s=!1;return{s:function(){o=o.call(e)},n:function(){var e=o.next();return i=e.done,e},e:function(e){s=!0,r=e},f:function(){try{i||null==o.return||o.return()}finally{if(s)throw r}}}}(this._anyListeners.slice());try{for(n.s();!(t=n.n()).done;)t.value.apply(this,e)}catch(e){n.e(e)}finally{n.f()}}y(i(Le.prototype),"emit",this).apply(this,e)}},{key:"ack",value:function(o){var r=this,i=!1;return function(){if(!i){i=!0;for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];r.packet({type:a.ACK,id:o,data:t})}}}},{key:"onack",value:function(e){var t=this.acks[e.id];"function"==typeof t&&(t.apply(this,e.data),delete this.acks[e.id])}},{key:"onconnect",value:function(e){this.id=e,this.connected=!0,this.disconnected=!1,this.emitBuffered(),this.emitReserved("connect")}},{key:"emitBuffered",value:function(){var t=this;this.receiveBuffer.forEach(function(e){return t.emitEvent(e)}),this.receiveBuffer=[],this.sendBuffer.forEach(function(e){return t.packet(e)}),this.sendBuffer=[]}},{key:"ondisconnect",value:function(){this.destroy(),this.onclose("io server disconnect")}},{key:"destroy",value:function(){this.subs&&(this.subs.forEach(function(e){return e()}),this.subs=void 0),this.io._destroy(this)}},{key:"disconnect",value:function(){return this.connected&&this.packet({type:a.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}},{key:"close",value:function(){return this.disconnect()}},{key:"compress",value:function(e){return this.flags.compress=e,this}},{key:"volatile",get:function(){return this.flags.volatile=!0,this}},{key:"timeout",value:function(e){return this.flags.timeout=e,this}},{key:"onAny",value:function(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}},{key:"prependAny",value:function(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}},{key:"offAny",value:function(e){if(!this._anyListeners)return this;if(e){for(var t=this._anyListeners,n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyListeners=[];return this}},{key:"listenersAny",value:function(){return this._anyListeners||[]}}]),Le),Me=De;function Le(e,t,n){var o;return r(this,Le),(o=Ce.call(this)).connected=!1,o.disconnected=!0,o.receiveBuffer=[],o.sendBuffer=[],o.ids=0,o.acks={},o.flags={},o.io=e,o.nsp=t,n&&n.auth&&(o.auth=n.auth),o.io._autoConnect&&o.open(),o}function De(e){this.ms=(e=e||{}).min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=0<e.jitter&&e.jitter<=1?e.jitter:0,this.attempts=0}De.prototype.duration=function(){var e,t,n=this.ms*Math.pow(this.factor,this.attempts++);return this.jitter&&(e=Math.random(),t=Math.floor(e*this.jitter*n),n=0==(1&Math.floor(10*e))?n-t:n+t),0|Math.min(n,this.max)},De.prototype.reset=function(){this.attempts=0},De.prototype.setMin=function(e){this.ms=e},De.prototype.setMax=function(e){this.max=e},De.prototype.setJitter=function(e){this.jitter=e};h(He,t),Ve=_(He),e(He,[{key:"reconnection",value:function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}},{key:"reconnectionAttempts",value:function(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}},{key:"reconnectionDelay",value:function(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}},{key:"randomizationFactor",value:function(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}},{key:"reconnectionDelayMax",value:function(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}},{key:"timeout",value:function(e){return arguments.length?(this._timeout=e,this):this._timeout}},{key:"maybeReconnectOnOpen",value:function(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}},{key:"open",value:function(t){var n=this;if(~this._readyState.indexOf("open"))return this;this.engine=new ye(this.uri,this.opts);var e,o,r=this.engine,i=this,s=(this._readyState="opening",this.skipReconnect=!1,u(r,"open",function(){i.onopen(),t&&t()})),a=u(r,"error",function(e){i.cleanup(),i._readyState="closed",n.emitReserved("error",e),t?t(e):i.maybeReconnectOnOpen()});return!1!==this._timeout&&(0===(e=this._timeout)&&s(),o=this.setTimeoutFn(function(){s(),r.close(),r.emit("error",new Error("timeout"))},e),this.opts.autoUnref&&o.unref(),this.subs.push(function(){clearTimeout(o)})),this.subs.push(s),this.subs.push(a),this}},{key:"connect",value:function(e){return this.open(e)}},{key:"onopen",value:function(){this.cleanup(),this._readyState="open",this.emitReserved("open");var e=this.engine;this.subs.push(u(e,"ping",this.onping.bind(this)),u(e,"data",this.ondata.bind(this)),u(e,"error",this.onerror.bind(this)),u(e,"close",this.onclose.bind(this)),u(this.decoder,"decoded",this.ondecoded.bind(this)))}},{key:"onping",value:function(){this.emitReserved("ping")}},{key:"ondata",value:function(e){this.decoder.add(e)}},{key:"ondecoded",value:function(e){this.emitReserved("packet",e)}},{key:"onerror",value:function(e){this.emitReserved("error",e)}},{key:"socket",value:function(e,t){var n=this.nsps[e];return n||(n=new Oe(this,e,t),this.nsps[e]=n),n}},{key:"_destroy",value:function(e){for(var t=0,n=Object.keys(this.nsps);t<n.length;t++){var o=n[t];if(this.nsps[o].active)return}this._close()}},{key:"_packet",value:function(e){for(var t=this.encoder.encode(e),n=0;n<t.length;n++)this.engine.write(t[n],e.options)}},{key:"cleanup",value:function(){this.subs.forEach(function(e){return e()}),this.subs.length=0,this.decoder.destroy()}},{key:"_close",value:function(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}},{key:"disconnect",value:function(){return this._close()}},{key:"onclose",value:function(e){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()}},{key:"reconnect",value:function(){var t=this;if(this._reconnecting||this.skipReconnect)return this;var e,n,o=this;this.backoff.attempts>=this._reconnectionAttempts?(this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1):(e=this.backoff.duration(),this._reconnecting=!0,n=this.setTimeoutFn(function(){o.skipReconnect||(t.emitReserved("reconnect_attempt",o.backoff.attempts),o.skipReconnect||o.open(function(e){e?(o._reconnecting=!1,o.reconnect(),t.emitReserved("reconnect_error",e)):o.onreconnect()}))},e),this.opts.autoUnref&&n.unref(),this.subs.push(function(){clearTimeout(n)}))}},{key:"onreconnect",value:function(){var e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}]);var Ve,Ne=He,je={};function He(e,t){r(this,He),(n=Ve.call(this)).nsps={},n.subs=[],e&&"object"===c(e)&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",n.opts=t,P(f(n),t),n.reconnection(!1!==t.reconnection),n.reconnectionAttempts(t.reconnectionAttempts||1/0),n.reconnectionDelay(t.reconnectionDelay||1e3),n.reconnectionDelayMax(t.reconnectionDelayMax||5e3),n.randomizationFactor(null!==(o=t.randomizationFactor)&&void 0!==o?o:.5),n.backoff=new Me({min:n.reconnectionDelay(),max:n.reconnectionDelayMax(),jitter:n.randomizationFactor()}),n.timeout(null==t.timeout?2e4:t.timeout),n._readyState="closed",n.uri=e;var n,o=t.parser||Ee;return n.encoder=new o.Encoder,n.decoder=new o.Decoder,n._autoConnect=!1!==t.autoConnect,n._autoConnect&&n.open(),n}function Fe(e,t){"object"===c(e)&&(t=e,e=void 0);var e=function(e,t,n){var t=1<arguments.length&&void 0!==t?t:"",o=e,n=(2<arguments.length?n:void 0)||"undefined"!=typeof location&&location,e=("string"==typeof(e=null==e?n.protocol+"//"+n.host:e)&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?n.protocol+e:n.host+e),/^(https?|wss?):\/\//.test(e)||(e=n.protocol+"//"+e),o=v(e)),o.port||(/^(http|ws)$/.test(o.protocol)?o.port="80":/^(http|ws)s$/.test(o.protocol)&&(o.port="443")),o.path=o.path||"/",-1!==o.host.indexOf(":")?"["+o.host+"]":o.host);return o.id=o.protocol+"://"+e+":"+o.port+t,o.href=o.protocol+"://"+e+(n&&n.port===o.port?"":":"+o.port),o}(e,(t=t||{}).path||"/socket.io"),n=e.source,o=e.id,r=e.path,r=je[o]&&r in je[o].nsps,r=t.forceNew||t["force new connection"]||!1===t.multiplex||r?new Ne(n,t):(je[o]||(je[o]=new Ne(n,t)),je[o]);return e.query&&!t.query&&(t.query=e.queryKey),r.socket(e.path,t)}return d(Fe,{Manager:Ne,Socket:Oe,io:Fe,connect:Fe}),Fe}),function(){"use strict";function e(){this.init()}function t(e){e.src&&0!==e.src.length?this.init(e):console.error("An array of source files must be passed with any new Howl.")}e.prototype={init:function(){var e=this||v;return e._counter=1e3,e._html5AudioPool=[],e.html5PoolSize=10,e._codecs={},e._howls=[],e._muted=!1,e._volume=1,e._canPlayEvent="canplaythrough",e._navigator="undefined"!=typeof window&&window.navigator?window.navigator:null,e.masterGain=null,e.noAudio=!1,e.usingWebAudio=!0,e.autoSuspend=!0,e.ctx=null,e.autoUnlock=!0,e._setup(),e},volume:function(e){var t=this||v;if(e=parseFloat(e),t.ctx||d(),void 0!==e&&0<=e&&e<=1){if(t._volume=e,t._muted)return t;t.usingWebAudio&&t.masterGain.gain.setValueAtTime(e,v.ctx.currentTime);for(var n=0;n<t._howls.length;n++)if(!t._howls[n]._webAudio)for(var o=t._howls[n]._getSoundIds(),r=0;r<o.length;r++){var i=t._howls[n]._soundById(o[r]);i&&i._node&&(i._node.volume=i._volume*e)}return t}return t._volume},mute:function(e){var t=this||v;t.ctx||d(),t._muted=e,t.usingWebAudio&&t.masterGain.gain.setValueAtTime(e?0:t._volume,v.ctx.currentTime);for(var n=0;n<t._howls.length;n++)if(!t._howls[n]._webAudio)for(var o=t._howls[n]._getSoundIds(),r=0;r<o.length;r++){var i=t._howls[n]._soundById(o[r]);i&&i._node&&(i._node.muted=!!e||i._muted)}return t},stop:function(){for(var e=this||v,t=0;t<e._howls.length;t++)e._howls[t].stop();return e},unload:function(){for(var e=this||v,t=e._howls.length-1;0<=t;t--)e._howls[t].unload();return e.usingWebAudio&&e.ctx&&void 0!==e.ctx.close&&(e.ctx.close(),e.ctx=null,d()),e},codecs:function(e){return(this||v)._codecs[e.replace(/^x-/,"")]},_setup:function(){var t=this||v;if(t.state=t.ctx&&t.ctx.state||"suspended",t._autoSuspend(),!t.usingWebAudio)if("undefined"!=typeof Audio)try{void 0===(new Audio).oncanplaythrough&&(t._canPlayEvent="canplay")}catch(e){t.noAudio=!0}else t.noAudio=!0;try{(new Audio).muted&&(t.noAudio=!0)}catch(t){}return t.noAudio||t._setupCodecs(),t},_setupCodecs:function(){var t=this||v,e=null;try{e="undefined"!=typeof Audio?new Audio:null}catch(e){return t}if(!e||"function"!=typeof e.canPlayType)return t;var n=e.canPlayType("audio/mpeg;").replace(/^no$/,""),o=t._navigator?t._navigator.userAgent:"",r=o.match(/OPR\/([0-6].)/g),r=r&&parseInt(r[0].split("/")[1],10)<33,i=-1!==o.indexOf("Safari")&&-1===o.indexOf("Chrome"),o=o.match(/Version\/(.*?) /),i=i&&o&&parseInt(o[1],10)<15;return t._codecs={mp3:!(r||!n&&!e.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!n,opus:!!e.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(e.canPlayType('audio/wav; codecs="1"')||e.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!e.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!e.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(e.canPlayType("audio/x-m4a;")||e.canPlayType("audio/m4a;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(e.canPlayType("audio/x-m4b;")||e.canPlayType("audio/m4b;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(e.canPlayType("audio/x-mp4;")||e.canPlayType("audio/mp4;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!(i||!e.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!(i||!e.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!e.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(e.canPlayType("audio/x-flac;")||e.canPlayType("audio/flac;")).replace(/^no$/,"")},t},_unlockAudio:function(){var a,c=this||v;if(!c._audioUnlocked&&c.ctx)return c._audioUnlocked=!1,c.autoUnlock=!1,c._mobileUnloaded||44100===c.ctx.sampleRate||(c._mobileUnloaded=!0,c.unload()),c._scratchBuffer=c.ctx.createBuffer(1,1,22050),a=function(e){for(;c._html5AudioPool.length<c.html5PoolSize;)try{var t=new Audio;t._unlocked=!0,c._releaseHtml5Audio(t)}catch(e){c.noAudio=!0;break}for(var n=0;n<c._howls.length;n++)if(!c._howls[n]._webAudio)for(var o=c._howls[n]._getSoundIds(),r=0;r<o.length;r++){var i=c._howls[n]._soundById(o[r]);i&&i._node&&!i._node._unlocked&&(i._node._unlocked=!0,i._node.load())}c._autoResume();var s=c.ctx.createBufferSource();s.buffer=c._scratchBuffer,s.connect(c.ctx.destination),void 0===s.start?s.noteOn(0):s.start(0),"function"==typeof c.ctx.resume&&c.ctx.resume(),s.onended=function(){s.disconnect(0),c._audioUnlocked=!0,document.removeEventListener("touchstart",a,!0),document.removeEventListener("touchend",a,!0),document.removeEventListener("click",a,!0),document.removeEventListener("keydown",a,!0);for(var e=0;e<c._howls.length;e++)c._howls[e]._emit("unlock")}},document.addEventListener("touchstart",a,!0),document.addEventListener("touchend",a,!0),document.addEventListener("click",a,!0),document.addEventListener("keydown",a,!0),c},_obtainHtml5Audio:function(){var e=this||v;if(e._html5AudioPool.length)return e._html5AudioPool.pop();e=(new Audio).play();return e&&"undefined"!=typeof Promise&&(e instanceof Promise||"function"==typeof e.then)&&e.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(e){var t=this||v;return e._unlocked&&t._html5AudioPool.push(e),t},_autoSuspend:function(){var t=this;if(t.autoSuspend&&t.ctx&&void 0!==t.ctx.suspend&&v.usingWebAudio){for(var e=0;e<t._howls.length;e++)if(t._howls[e]._webAudio)for(var n=0;n<t._howls[e]._sounds.length;n++)if(!t._howls[e]._sounds[n]._paused)return t;return t._suspendTimer&&clearTimeout(t._suspendTimer),t._suspendTimer=setTimeout(function(){var e;t.autoSuspend&&(t._suspendTimer=null,t.state="suspending",e=function(){t.state="suspended",t._resumeAfterSuspend&&(delete t._resumeAfterSuspend,t._autoResume())},t.ctx.suspend().then(e,e))},3e4),t}},_autoResume:function(){var t=this;if(t.ctx&&void 0!==t.ctx.resume&&v.usingWebAudio)return"running"===t.state&&"interrupted"!==t.ctx.state&&t._suspendTimer?(clearTimeout(t._suspendTimer),t._suspendTimer=null):"suspended"===t.state||"running"===t.state&&"interrupted"===t.ctx.state?(t.ctx.resume().then(function(){t.state="running";for(var e=0;e<t._howls.length;e++)t._howls[e]._emit("resume")}),t._suspendTimer&&(clearTimeout(t._suspendTimer),t._suspendTimer=null)):"suspending"===t.state&&(t._resumeAfterSuspend=!0),t}};var v=new e,i=(t.prototype={init:function(e){var t=this;return v.ctx||d(),t._autoplay=e.autoplay||!1,t._format="string"!=typeof e.format?e.format:[e.format],t._html5=e.html5||!1,t._muted=e.mute||!1,t._loop=e.loop||!1,t._pool=e.pool||5,t._preload="boolean"!=typeof e.preload&&"metadata"!==e.preload||e.preload,t._rate=e.rate||1,t._sprite=e.sprite||{},t._src="string"!=typeof e.src?e.src:[e.src],t._volume=void 0!==e.volume?e.volume:1,t._xhr={method:e.xhr&&e.xhr.method?e.xhr.method:"GET",headers:e.xhr&&e.xhr.headers?e.xhr.headers:null,withCredentials:!(!e.xhr||!e.xhr.withCredentials)&&e.xhr.withCredentials},t._duration=0,t._state="unloaded",t._sounds=[],t._endTimers={},t._queue=[],t._playLock=!1,t._onend=e.onend?[{fn:e.onend}]:[],t._onfade=e.onfade?[{fn:e.onfade}]:[],t._onload=e.onload?[{fn:e.onload}]:[],t._onloaderror=e.onloaderror?[{fn:e.onloaderror}]:[],t._onplayerror=e.onplayerror?[{fn:e.onplayerror}]:[],t._onpause=e.onpause?[{fn:e.onpause}]:[],t._onplay=e.onplay?[{fn:e.onplay}]:[],t._onstop=e.onstop?[{fn:e.onstop}]:[],t._onmute=e.onmute?[{fn:e.onmute}]:[],t._onvolume=e.onvolume?[{fn:e.onvolume}]:[],t._onrate=e.onrate?[{fn:e.onrate}]:[],t._onseek=e.onseek?[{fn:e.onseek}]:[],t._onunlock=e.onunlock?[{fn:e.onunlock}]:[],t._onresume=[],t._webAudio=v.usingWebAudio&&!t._html5,void 0!==v.ctx&&v.ctx&&v.autoUnlock&&v._unlockAudio(),v._howls.push(t),t._autoplay&&t._queue.push({event:"play",action:function(){t.play()}}),t._preload&&"none"!==t._preload&&t.load(),t},load:function(){var e=this,t=null;if(!v.noAudio){"string"==typeof e._src&&(e._src=[e._src]);for(var n,o,r=0;r<e._src.length;r++){if(e._format&&e._format[r])n=e._format[r];else{if("string"!=typeof(o=e._src[r])){e._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}n=(n=(n=/^data:audio\/([^;,]+);/i.exec(o))||/\.([^.]+)$/.exec(o.split("?",1)[0]))&&n[1].toLowerCase()}if(n||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),n&&v.codecs(n)){t=e._src[r];break}}return t?(e._src=t,e._state="loading","https:"===window.location.protocol&&"http:"===t.slice(0,5)&&(e._html5=!0,e._webAudio=!1),new i(e),e._webAudio&&a(e),e):void e._emit("loaderror",null,"No codec support for selected audio sources.")}e._emit("loaderror",null,"No audio support.")},play:function(t,n){var o=this,e=null;if("number"==typeof t)e=t,t=null;else{if("string"==typeof t&&"loaded"===o._state&&!o._sprite[t])return null;if(void 0===t&&(t="__default",!o._playLock)){for(var l=0,r=0;r<o._sounds.length;r++)o._sounds[r]._paused&&!o._sounds[r]._ended&&(l++,e=o._sounds[r]._id);1===l?t=null:e=null}}var i,s=e?o._soundById(e):o._inactiveSound();if(!s)return null;if(e&&!t&&(t=s._sprite||"__default"),"loaded"!==o._state)return s._sprite=t,s._ended=!1,i=s._id,o._queue.push({event:"play",action:function(){o.play(i)}}),i;if(e&&!s._paused)return n||o._loadQueue("play"),s._id;o._webAudio&&v._autoResume();var a,d,c,h,u=Math.max(0,0<s._seek?s._seek:o._sprite[t][0]/1e3),p=Math.max(0,(o._sprite[t][0]+o._sprite[t][1])/1e3-u),f=1e3*p/Math.abs(s._rate),_=o._sprite[t][0]/1e3,y=(o._sprite[t][0]+o._sprite[t][1])/1e3,m=(s._sprite=t,s._ended=!1,function(){s._paused=!1,s._seek=u,s._start=_,s._stop=y,s._loop=!(!s._loop&&!o._sprite[t][2])});{if(!(y<=u))return a=s._node,o._webAudio?(c=function(){o._playLock=!1,m(),o._refreshBuffer(s);var e=s._muted||o._muted?0:s._volume;a.gain.setValueAtTime(e,v.ctx.currentTime),s._playStart=v.ctx.currentTime,void 0===a.bufferSource.start?s._loop?a.bufferSource.noteGrainOn(0,u,86400):a.bufferSource.noteGrainOn(0,u,p):s._loop?a.bufferSource.start(0,u,86400):a.bufferSource.start(0,u,p),f!==1/0&&(o._endTimers[s._id]=setTimeout(o._ended.bind(o,s),f)),n||setTimeout(function(){o._emit("play",s._id),o._loadQueue()},0)},"running"===v.state&&"interrupted"!==v.ctx.state?c():(o._playLock=!0,o.once("resume",c),o._clearTimer(s._id))):(d=function(){a.currentTime=u,a.muted=s._muted||o._muted||v._muted||a.muted,a.volume=s._volume*v.volume(),a.playbackRate=s._rate;try{var e=a.play();if(e&&"undefined"!=typeof Promise&&(e instanceof Promise||"function"==typeof e.then)?(o._playLock=!0,m(),e.then(function(){o._playLock=!1,a._unlocked=!0,n?o._loadQueue():o._emit("play",s._id)}).catch(function(){o._playLock=!1,o._emit("playerror",s._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),s._ended=!0,s._paused=!0})):n||(o._playLock=!1,m(),o._emit("play",s._id)),a.playbackRate=s._rate,a.paused)return void o._emit("playerror",s._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");"__default"!==t||s._loop?o._endTimers[s._id]=setTimeout(o._ended.bind(o,s),f):(o._endTimers[s._id]=function(){o._ended(s),a.removeEventListener("ended",o._endTimers[s._id],!1)},a.addEventListener("ended",o._endTimers[s._id],!1))}catch(e){o._emit("playerror",s._id,e)}},"data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"===a.src&&(a.src=o._src,a.load()),c=window&&window.ejecta||!a.readyState&&v._navigator.isCocoonJS,3<=a.readyState||c?d():(o._playLock=!0,o._state="loading",h=function(){o._state="loaded",d(),a.removeEventListener(v._canPlayEvent,h,!1)},a.addEventListener(v._canPlayEvent,h,!1),o._clearTimer(s._id))),s._id;o._ended(s)}},pause:function(e){var t=this;if("loaded"!==t._state||t._playLock)return t._queue.push({event:"pause",action:function(){t.pause(e)}}),t;for(var n=t._getSoundIds(e),o=0;o<n.length;o++){t._clearTimer(n[o]);var r=t._soundById(n[o]);if(r&&!r._paused&&(r._seek=t.seek(n[o]),r._rateSeek=0,r._paused=!0,t._stopFade(n[o]),r._node))if(t._webAudio){if(!r._node.bufferSource)continue;void 0===r._node.bufferSource.stop?r._node.bufferSource.noteOff(0):r._node.bufferSource.stop(0),t._cleanBuffer(r._node)}else isNaN(r._node.duration)&&r._node.duration!==1/0||r._node.pause();arguments[1]||t._emit("pause",r?r._id:null)}return t},stop:function(e,t){var n=this;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"stop",action:function(){n.stop(e)}}),n;for(var o=n._getSoundIds(e),r=0;r<o.length;r++){n._clearTimer(o[r]);var i=n._soundById(o[r]);i&&(i._seek=i._start||0,i._rateSeek=0,i._paused=!0,i._ended=!0,n._stopFade(o[r]),i._node&&(n._webAudio?i._node.bufferSource&&(void 0===i._node.bufferSource.stop?i._node.bufferSource.noteOff(0):i._node.bufferSource.stop(0),n._cleanBuffer(i._node)):isNaN(i._node.duration)&&i._node.duration!==1/0||(i._node.currentTime=i._start||0,i._node.pause(),i._node.duration===1/0&&n._clearSound(i._node))),t||n._emit("stop",i._id))}return n},mute:function(e,t){var n=this;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"mute",action:function(){n.mute(e,t)}}),n;if(void 0===t){if("boolean"!=typeof e)return n._muted;n._muted=e}for(var o=n._getSoundIds(t),r=0;r<o.length;r++){var i=n._soundById(o[r]);i&&(i._muted=e,i._interval&&n._stopFade(i._id),n._webAudio&&i._node?i._node.gain.setValueAtTime(e?0:i._volume,v.ctx.currentTime):i._node&&(i._node.muted=!!v._muted||e),n._emit("mute",i._id))}return n},volume:function(){var e,t,n=this,o=arguments;if(0===o.length)return n._volume;if(1===o.length||2===o.length&&void 0===o[1]?0<=n._getSoundIds().indexOf(o[0])?r=parseInt(o[0],10):e=parseFloat(o[0]):2<=o.length&&(e=parseFloat(o[0]),r=parseInt(o[1],10)),!(void 0!==e&&0<=e&&e<=1))return(t=r?n._soundById(r):n._sounds[0])?t._volume:0;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"volume",action:function(){n.volume.apply(n,o)}}),n;void 0===r&&(n._volume=e);for(var r=n._getSoundIds(r),i=0;i<r.length;i++)(t=n._soundById(r[i]))&&(t._volume=e,o[2]||n._stopFade(r[i]),n._webAudio&&t._node&&!t._muted?t._node.gain.setValueAtTime(e,v.ctx.currentTime):t._node&&!t._muted&&(t._node.volume=e*v.volume()),n._emit("volume",t._id));return n},fade:function(e,t,n,o){var r=this;if("loaded"!==r._state||r._playLock)return r._queue.push({event:"fade",action:function(){r.fade(e,t,n,o)}}),r;e=Math.min(Math.max(0,parseFloat(e)),1),t=Math.min(Math.max(0,parseFloat(t)),1),n=parseFloat(n),r.volume(e,o);for(var i=r._getSoundIds(o),s=0;s<i.length;s++){var a,c,u=r._soundById(i[s]);u&&(o||r._stopFade(i[s]),r._webAudio&&!u._muted&&(c=(a=v.ctx.currentTime)+n/1e3,u._volume=e,u._node.gain.setValueAtTime(e,a),u._node.gain.linearRampToValueAtTime(t,c)),r._startFadeInterval(u,e,t,n,i[s],void 0===o))}return r},_startFadeInterval:function(t,n,o,r,l,i){var s=this,a=n,c=o-n,e=Math.abs(c/.01),e=Math.max(4,0<e?r/e:r),u=Date.now();t._fadeTo=o,t._interval=setInterval(function(){var e=(Date.now()-u)/r;u=Date.now(),a+=c*e,a=Math.round(100*a)/100,a=c<0?Math.max(o,a):Math.min(o,a),s._webAudio?t._volume=a:s.volume(a,t._id,!0),i&&(s._volume=a),(o<n&&a<=o||n<o&&o<=a)&&(clearInterval(t._interval),t._interval=null,t._fadeTo=null,s.volume(o,t._id),s._emit("fade",t._id))},e)},_stopFade:function(e){var t=this,n=t._soundById(e);return n&&n._interval&&(t._webAudio&&n._node.gain.cancelScheduledValues(v.ctx.currentTime),clearInterval(n._interval),n._interval=null,t.volume(n._fadeTo,e),n._fadeTo=null,t._emit("fade",e)),t},loop:function(){var e,t,n,o=this,r=arguments;if(0===r.length)return o._loop;if(1===r.length){if("boolean"!=typeof r[0])return!!(n=o._soundById(parseInt(r[0],10)))&&n._loop;o._loop=e=r[0]}else 2===r.length&&(e=r[0],t=parseInt(r[1],10));for(var i=o._getSoundIds(t),s=0;s<i.length;s++)(n=o._soundById(i[s]))&&(n._loop=e,o._webAudio&&n._node&&n._node.bufferSource&&((n._node.bufferSource.loop=e)&&(n._node.bufferSource.loopStart=n._start||0,n._node.bufferSource.loopEnd=n._stop,o.playing(i[s])&&(o.pause(i[s],!0),o.play(i[s],!0)))));return o},rate:function(){var e,t,n=this,o=arguments;if(0===o.length?i=n._sounds[0]._id:1===o.length?0<=n._getSoundIds().indexOf(o[0])?i=parseInt(o[0],10):e=parseFloat(o[0]):2===o.length&&(e=parseFloat(o[0]),i=parseInt(o[1],10)),"number"!=typeof e)return((t=n._soundById(i))||n)._rate;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"rate",action:function(){n.rate.apply(n,o)}}),n;void 0===i&&(n._rate=e);for(var r,i=n._getSoundIds(i),s=0;s<i.length;s++)(t=n._soundById(i[s]))&&(n.playing(i[s])&&(t._rateSeek=n.seek(i[s]),t._playStart=n._webAudio?v.ctx.currentTime:t._playStart),t._rate=e,n._webAudio&&t._node&&t._node.bufferSource?t._node.bufferSource.playbackRate.setValueAtTime(e,v.ctx.currentTime):t._node&&(t._node.playbackRate=e),r=n.seek(i[s]),r=1e3*((n._sprite[t._sprite][0]+n._sprite[t._sprite][1])/1e3-r)/Math.abs(t._rate),!n._endTimers[i[s]]&&t._paused||(n._clearTimer(i[s]),n._endTimers[i[s]]=setTimeout(n._ended.bind(n,t),r)),n._emit("rate",t._id));return n},seek:function(){var e,t,n=this,o=arguments;if(0===o.length?n._sounds.length&&(t=n._sounds[0]._id):1===o.length?0<=n._getSoundIds().indexOf(o[0])?t=parseInt(o[0],10):n._sounds.length&&(t=n._sounds[0]._id,e=parseFloat(o[0])):2===o.length&&(e=parseFloat(o[0]),t=parseInt(o[1],10)),void 0===t)return 0;if("number"==typeof e&&("loaded"!==n._state||n._playLock))return n._queue.push({event:"seek",action:function(){n.seek.apply(n,o)}}),n;var r,i,s=n._soundById(t);if(s){if(!("number"==typeof e&&0<=e))return n._webAudio?(r=n.playing(t)?v.ctx.currentTime-s._playStart:0,i=s._rateSeek?s._rateSeek-s._seek:0,s._seek+(i+r*Math.abs(s._rate))):s._node.currentTime;var a,c=n.playing(t),u=(c&&n.pause(t,!0),s._seek=e,s._ended=!1,n._clearTimer(t),n._webAudio||!s._node||isNaN(s._node.duration)||(s._node.currentTime=e),function(){c&&n.play(t,!0),n._emit("seek",t)});c&&!n._webAudio?(a=function(){n._playLock?setTimeout(a,0):u()},setTimeout(a,0)):u()}return n},playing:function(e){if("number"==typeof e)return!!(e=this._soundById(e))&&!e._paused;for(var t=0;t<this._sounds.length;t++)if(!this._sounds[t]._paused)return!0;return!1},duration:function(e){var t=this._duration,e=this._soundById(e);return t=e?this._sprite[e._sprite][1]/1e3:t},state:function(){return this._state},unload:function(){for(var e=this,t=e._sounds,n=0;n<t.length;n++)t[n]._paused||e.stop(t[n]._id),e._webAudio||(e._clearSound(t[n]._node),t[n]._node.removeEventListener("error",t[n]._errorFn,!1),t[n]._node.removeEventListener(v._canPlayEvent,t[n]._loadFn,!1),t[n]._node.removeEventListener("ended",t[n]._endFn,!1),v._releaseHtml5Audio(t[n]._node)),delete t[n]._node,e._clearTimer(t[n]._id);for(var o=v._howls.indexOf(e),r=(0<=o&&v._howls.splice(o,1),!0),n=0;n<v._howls.length;n++)if(v._howls[n]._src===e._src||0<=e._src.indexOf(v._howls[n]._src)){r=!1;break}return s&&r&&delete s[e._src],v.noAudio=!1,e._state="unloaded",e._sounds=[],null},on:function(e,t,n,o){e=this["_on"+e];return"function"==typeof t&&e.push(o?{id:n,fn:t,once:o}:{id:n,fn:t}),this},off:function(e,t,n){var o=this,r=o["_on"+e],i=0;if("number"==typeof t&&(n=t,t=null),t||n)for(i=0;i<r.length;i++){var s=n===r[i].id;if(t===r[i].fn&&s||!t&&s){r.splice(i,1);break}}else if(e)o["_on"+e]=[];else for(var a=Object.keys(o),i=0;i<a.length;i++)0===a[i].indexOf("_on")&&Array.isArray(o[a[i]])&&(o[a[i]]=[]);return o},once:function(e,t,n){return this.on(e,t,n,1),this},_emit:function(e,t,n){for(var o=this,r=o["_on"+e],i=r.length-1;0<=i;i--)r[i].id&&r[i].id!==t&&"load"!==e||(setTimeout(function(e){e.call(this,t,n)}.bind(o,r[i].fn),0),r[i].once&&o.off(e,r[i].fn,r[i].id));return o._loadQueue(e),o},_loadQueue:function(e){var t,n=this;return 0<n._queue.length&&((t=n._queue[0]).event===e&&(n._queue.shift(),n._loadQueue()),e||t.action()),n},_ended:function(e){var t=this,n=e._sprite;if(!t._webAudio&&e._node&&!e._node.paused&&!e._node.ended&&e._node.currentTime<e._stop)return setTimeout(t._ended.bind(t,e),100),t;var o,n=!(!e._loop&&!t._sprite[n][2]);return t._emit("end",e._id),!t._webAudio&&n&&t.stop(e._id,!0).play(e._id),t._webAudio&&n&&(t._emit("play",e._id),e._seek=e._start||0,e._rateSeek=0,e._playStart=v.ctx.currentTime,o=1e3*(e._stop-e._start)/Math.abs(e._rate),t._endTimers[e._id]=setTimeout(t._ended.bind(t,e),o)),t._webAudio&&!n&&(e._paused=!0,e._ended=!0,e._seek=e._start||0,e._rateSeek=0,t._clearTimer(e._id),t._cleanBuffer(e._node),v._autoSuspend()),t._webAudio||n||t.stop(e._id,!0),t},_clearTimer:function(e){var t,n=this;return n._endTimers[e]&&("function"!=typeof n._endTimers[e]?clearTimeout(n._endTimers[e]):(t=n._soundById(e))&&t._node&&t._node.removeEventListener("ended",n._endTimers[e],!1),delete n._endTimers[e]),n},_soundById:function(e){for(var t=0;t<this._sounds.length;t++)if(e===this._sounds[t]._id)return this._sounds[t];return null},_inactiveSound:function(){var e=this;e._drain();for(var t=0;t<e._sounds.length;t++)if(e._sounds[t]._ended)return e._sounds[t].reset();return new i(e)},_drain:function(){var e=this,t=e._pool,n=0,o=0;if(!(e._sounds.length<t)){for(o=0;o<e._sounds.length;o++)e._sounds[o]._ended&&n++;for(o=e._sounds.length-1;0<=o;o--){if(n<=t)return;e._sounds[o]._ended&&(e._webAudio&&e._sounds[o]._node&&e._sounds[o]._node.disconnect(0),e._sounds.splice(o,1),n--)}}},_getSoundIds:function(e){if(void 0!==e)return[e];for(var t=[],n=0;n<this._sounds.length;n++)t.push(this._sounds[n]._id);return t},_refreshBuffer:function(e){return e._node.bufferSource=v.ctx.createBufferSource(),e._node.bufferSource.buffer=s[this._src],e._panner?e._node.bufferSource.connect(e._panner):e._node.bufferSource.connect(e._node),e._node.bufferSource.loop=e._loop,e._loop&&(e._node.bufferSource.loopStart=e._start||0,e._node.bufferSource.loopEnd=e._stop||0),e._node.bufferSource.playbackRate.setValueAtTime(e._rate,v.ctx.currentTime),this},_cleanBuffer:function(e){var t=v._navigator&&0<=v._navigator.vendor.indexOf("Apple");if(v._scratchBuffer&&e.bufferSource&&(e.bufferSource.onended=null,e.bufferSource.disconnect(0),t))try{e.bufferSource.buffer=v._scratchBuffer}catch(e){}return e.bufferSource=null,this},_clearSound:function(e){/MSIE |Trident\//.test(v._navigator&&v._navigator.userAgent)||(e.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}},function(e){this._parent=e,this.init()}),s=(i.prototype={init:function(){var e=this,t=e._parent;return e._muted=t._muted,e._loop=t._loop,e._volume=t._volume,e._rate=t._rate,e._seek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++v._counter,t._sounds.push(e),e.create(),e},create:function(){var e=this,t=e._parent,n=v._muted||e._muted||e._parent._muted?0:e._volume;return t._webAudio?(e._node=void 0===v.ctx.createGain?v.ctx.createGainNode():v.ctx.createGain(),e._node.gain.setValueAtTime(n,v.ctx.currentTime),e._node.paused=!0,e._node.connect(v.masterGain)):v.noAudio||(e._node=v._obtainHtml5Audio(),e._errorFn=e._errorListener.bind(e),e._node.addEventListener("error",e._errorFn,!1),e._loadFn=e._loadListener.bind(e),e._node.addEventListener(v._canPlayEvent,e._loadFn,!1),e._endFn=e._endListener.bind(e),e._node.addEventListener("ended",e._endFn,!1),e._node.src=t._src,e._node.preload=!0===t._preload?"auto":t._preload,e._node.volume=n*v.volume(),e._node.load()),e},reset:function(){var e=this,t=e._parent;return e._muted=t._muted,e._loop=t._loop,e._volume=t._volume,e._rate=t._rate,e._seek=0,e._rateSeek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++v._counter,e},_errorListener:function(){var e=this;e._parent._emit("loaderror",e._id,e._node.error?e._node.error.code:0),e._node.removeEventListener("error",e._errorFn,!1)},_loadListener:function(){var e=this._parent;e._duration=Math.ceil(10*this._node.duration)/10,0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue()),this._node.removeEventListener(v._canPlayEvent,this._loadFn,!1)},_endListener:function(){var e=this,t=e._parent;t._duration===1/0&&(t._duration=Math.ceil(10*e._node.duration)/10,t._sprite.__default[1]===1/0&&(t._sprite.__default[1]=1e3*t._duration),t._ended(e)),e._node.removeEventListener("ended",e._endFn,!1)}},{}),a=function(t){var e=t._src;if(s[e])return t._duration=s[e].duration,void l(t);if(/^data:[^;]+;base64,/.test(e)){for(var n=atob(e.split(",")[1]),o=new Uint8Array(n.length),r=0;r<n.length;++r)o[r]=n.charCodeAt(r);u(o.buffer,t)}else{var i=new XMLHttpRequest;i.open(t._xhr.method,e,!0),i.withCredentials=t._xhr.withCredentials,i.responseType="arraybuffer",t._xhr.headers&&Object.keys(t._xhr.headers).forEach(function(e){i.setRequestHeader(e,t._xhr.headers[e])}),i.onload=function(){var e=(i.status+"")[0];"0"===e||"2"===e||"3"===e?u(i.response,t):t._emit("loaderror",null,"Failed loading audio file with status: "+i.status+".")},i.onerror=function(){t._webAudio&&(t._html5=!0,t._webAudio=!1,t._sounds=[],delete s[e],t.load())},c(i)}},c=function(t){try{t.send()}catch(e){t.onerror()}},u=function(e,t){function n(){t._emit("loaderror",null,"Decoding audio data failed.")}function o(e){e&&0<t._sounds.length?(s[t._src]=e,l(t,e)):n()}"undefined"!=typeof Promise&&1===v.ctx.decodeAudioData.length?v.ctx.decodeAudioData(e).then(o).catch(n):v.ctx.decodeAudioData(e,o,n)},l=function(e,t){t&&!e._duration&&(e._duration=t.duration),0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue())},d=function(){if(v.usingWebAudio){try{"undefined"!=typeof AudioContext?v.ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?v.ctx=new webkitAudioContext:v.usingWebAudio=!1}catch(e){v.usingWebAudio=!1}v.ctx||(v.usingWebAudio=!1);var e=/iP(hone|od|ad)/.test(v._navigator&&v._navigator.platform),t=v._navigator&&v._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),t=t?parseInt(t[1],10):null;e&&t&&t<9&&(t=/safari/.test(v._navigator&&v._navigator.userAgent.toLowerCase()),v._navigator&&!t&&(v.usingWebAudio=!1)),v.usingWebAudio&&(v.masterGain=void 0===v.ctx.createGain?v.ctx.createGainNode():v.ctx.createGain(),v.masterGain.gain.setValueAtTime(v._muted?0:v._volume,v.ctx.currentTime),v.masterGain.connect(v.ctx.destination)),v._setup()}};"function"==typeof define&&define.amd&&define([],function(){return{Howler:v,Howl:t}}),"undefined"!=typeof exports&&(exports.Howler=v,exports.Howl=t),"undefined"!=typeof global?(global.HowlerGlobal=e,global.Howler=v,global.Howl=t,global.Sound=i):"undefined"!=typeof window&&(window.HowlerGlobal=e,window.Howler=v,window.Howl=t,window.Sound=i)}(),function(){"use strict";HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(e){var t=this;if(!t.ctx||!t.ctx.listener)return t;for(var n=t._howls.length-1;0<=n;n--)t._howls[n].stereo(e);return t},HowlerGlobal.prototype.pos=function(e,t,n){var o=this;return o.ctx&&o.ctx.listener?(t="number"!=typeof t?o._pos[1]:t,n="number"!=typeof n?o._pos[2]:n,"number"!=typeof e?o._pos:(o._pos=[e,t,n],void 0!==o.ctx.listener.positionX?(o.ctx.listener.positionX.setTargetAtTime(o._pos[0],Howler.ctx.currentTime,.1),o.ctx.listener.positionY.setTargetAtTime(o._pos[1],Howler.ctx.currentTime,.1),o.ctx.listener.positionZ.setTargetAtTime(o._pos[2],Howler.ctx.currentTime,.1)):o.ctx.listener.setPosition(o._pos[0],o._pos[1],o._pos[2]),o)):o},HowlerGlobal.prototype.orientation=function(e,t,n,o,r,i){var s=this;if(!s.ctx||!s.ctx.listener)return s;var a=s._orientation;return t="number"!=typeof t?a[1]:t,n="number"!=typeof n?a[2]:n,o="number"!=typeof o?a[3]:o,r="number"!=typeof r?a[4]:r,i="number"!=typeof i?a[5]:i,"number"!=typeof e?a:(s._orientation=[e,t,n,o,r,i],void 0!==s.ctx.listener.forwardX?(s.ctx.listener.forwardX.setTargetAtTime(e,Howler.ctx.currentTime,.1),s.ctx.listener.forwardY.setTargetAtTime(t,Howler.ctx.currentTime,.1),s.ctx.listener.forwardZ.setTargetAtTime(n,Howler.ctx.currentTime,.1),s.ctx.listener.upX.setTargetAtTime(o,Howler.ctx.currentTime,.1),s.ctx.listener.upY.setTargetAtTime(r,Howler.ctx.currentTime,.1),s.ctx.listener.upZ.setTargetAtTime(i,Howler.ctx.currentTime,.1)):s.ctx.listener.setOrientation(e,t,n,o,r,i),s)},Howl.prototype.init=(r=Howl.prototype.init,function(e){var t=this;return t._orientation=e.orientation||[1,0,0],t._stereo=e.stereo||null,t._pos=e.pos||null,t._pannerAttr={coneInnerAngle:void 0!==e.coneInnerAngle?e.coneInnerAngle:360,coneOuterAngle:void 0!==e.coneOuterAngle?e.coneOuterAngle:360,coneOuterGain:void 0!==e.coneOuterGain?e.coneOuterGain:0,distanceModel:void 0!==e.distanceModel?e.distanceModel:"inverse",maxDistance:void 0!==e.maxDistance?e.maxDistance:1e4,panningModel:void 0!==e.panningModel?e.panningModel:"HRTF",refDistance:void 0!==e.refDistance?e.refDistance:1,rolloffFactor:void 0!==e.rolloffFactor?e.rolloffFactor:1},t._onstereo=e.onstereo?[{fn:e.onstereo}]:[],t._onpos=e.onpos?[{fn:e.onpos}]:[],t._onorientation=e.onorientation?[{fn:e.onorientation}]:[],r.call(this,e)}),Howl.prototype.stereo=function(e,t){var n=this;if(!n._webAudio)return n;if("loaded"!==n._state)return n._queue.push({event:"stereo",action:function(){n.stereo(e,t)}}),n;var o=void 0===Howler.ctx.createStereoPanner?"spatial":"stereo";if(void 0===t){if("number"!=typeof e)return n._stereo;n._stereo=e,n._pos=[e,0,0]}for(var r=n._getSoundIds(t),i=0;i<r.length;i++){var s=n._soundById(r[i]);if(s){if("number"!=typeof e)return s._stereo;s._stereo=e,s._pos=[e,0,0],s._node&&(s._pannerAttr.panningModel="equalpower",s._panner&&s._panner.pan||u(s,o),"spatial"==o?void 0!==s._panner.positionX?(s._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),s._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),s._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):s._panner.setPosition(e,0,0):s._panner.pan.setValueAtTime(e,Howler.ctx.currentTime)),n._emit("stereo",s._id)}}return n},Howl.prototype.pos=function(e,t,n,o){var r=this;if(!r._webAudio)return r;if("loaded"!==r._state)return r._queue.push({event:"pos",action:function(){r.pos(e,t,n,o)}}),r;if(t="number"!=typeof t?0:t,n="number"!=typeof n?-.5:n,void 0===o){if("number"!=typeof e)return r._pos;r._pos=[e,t,n]}for(var i=r._getSoundIds(o),s=0;s<i.length;s++){var a=r._soundById(i[s]);if(a){if("number"!=typeof e)return a._pos;a._pos=[e,t,n],a._node&&(a._panner&&!a._panner.pan||u(a,"spatial"),void 0!==a._panner.positionX?(a._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),a._panner.positionY.setValueAtTime(t,Howler.ctx.currentTime),a._panner.positionZ.setValueAtTime(n,Howler.ctx.currentTime)):a._panner.setPosition(e,t,n)),r._emit("pos",a._id)}}return r},Howl.prototype.orientation=function(e,t,n,o){var r=this;if(!r._webAudio)return r;if("loaded"!==r._state)return r._queue.push({event:"orientation",action:function(){r.orientation(e,t,n,o)}}),r;if(t="number"!=typeof t?r._orientation[1]:t,n="number"!=typeof n?r._orientation[2]:n,void 0===o){if("number"!=typeof e)return r._orientation;r._orientation=[e,t,n]}for(var i=r._getSoundIds(o),s=0;s<i.length;s++){var a=r._soundById(i[s]);if(a){if("number"!=typeof e)return a._orientation;a._orientation=[e,t,n],a._node&&(a._panner||(a._pos||(a._pos=r._pos||[0,0,-.5]),u(a,"spatial")),void 0!==a._panner.orientationX?(a._panner.orientationX.setValueAtTime(e,Howler.ctx.currentTime),a._panner.orientationY.setValueAtTime(t,Howler.ctx.currentTime),a._panner.orientationZ.setValueAtTime(n,Howler.ctx.currentTime)):a._panner.setOrientation(e,t,n)),r._emit("orientation",a._id)}}return r},Howl.prototype.pannerAttr=function(){var e,t,n,o=this,r=arguments;if(!o._webAudio)return o;if(0===r.length)return o._pannerAttr;if(1===r.length){if("object"!=typeof r[0])return((n=o._soundById(parseInt(r[0],10)))||o)._pannerAttr;e=r[0],void 0===t&&(e.pannerAttr||(e.pannerAttr={coneInnerAngle:e.coneInnerAngle,coneOuterAngle:e.coneOuterAngle,coneOuterGain:e.coneOuterGain,distanceModel:e.distanceModel,maxDistance:e.maxDistance,refDistance:e.refDistance,rolloffFactor:e.rolloffFactor,panningModel:e.panningModel}),o._pannerAttr={coneInnerAngle:void 0!==e.pannerAttr.coneInnerAngle?e.pannerAttr.coneInnerAngle:o._coneInnerAngle,coneOuterAngle:void 0!==e.pannerAttr.coneOuterAngle?e.pannerAttr.coneOuterAngle:o._coneOuterAngle,coneOuterGain:void 0!==e.pannerAttr.coneOuterGain?e.pannerAttr.coneOuterGain:o._coneOuterGain,distanceModel:void 0!==e.pannerAttr.distanceModel?e.pannerAttr.distanceModel:o._distanceModel,maxDistance:void 0!==e.pannerAttr.maxDistance?e.pannerAttr.maxDistance:o._maxDistance,refDistance:void 0!==e.pannerAttr.refDistance?e.pannerAttr.refDistance:o._refDistance,rolloffFactor:void 0!==e.pannerAttr.rolloffFactor?e.pannerAttr.rolloffFactor:o._rolloffFactor,panningModel:void 0!==e.pannerAttr.panningModel?e.pannerAttr.panningModel:o._panningModel})}else 2===r.length&&(e=r[0],t=parseInt(r[1],10));for(var i,s,a=o._getSoundIds(t),c=0;c<a.length;c++)(n=o._soundById(a[c]))&&(i=n._pannerAttr,i={coneInnerAngle:(void 0!==e.coneInnerAngle?e:i).coneInnerAngle,coneOuterAngle:(void 0!==e.coneOuterAngle?e:i).coneOuterAngle,coneOuterGain:(void 0!==e.coneOuterGain?e:i).coneOuterGain,distanceModel:(void 0!==e.distanceModel?e:i).distanceModel,maxDistance:(void 0!==e.maxDistance?e:i).maxDistance,refDistance:(void 0!==e.refDistance?e:i).refDistance,rolloffFactor:(void 0!==e.rolloffFactor?e:i).rolloffFactor,panningModel:(void 0!==e.panningModel?e:i).panningModel},(s=n._panner)?(s.coneInnerAngle=i.coneInnerAngle,s.coneOuterAngle=i.coneOuterAngle,s.coneOuterGain=i.coneOuterGain,s.distanceModel=i.distanceModel,s.maxDistance=i.maxDistance,s.refDistance=i.refDistance,s.rolloffFactor=i.rolloffFactor,s.panningModel=i.panningModel):(n._pos||(n._pos=o._pos||[0,0,-.5]),u(n,"spatial")));return o},Sound.prototype.init=(o=Sound.prototype.init,function(){var e=this,t=e._parent;e._orientation=t._orientation,e._stereo=t._stereo,e._pos=t._pos,e._pannerAttr=t._pannerAttr,o.call(this),e._stereo?t.stereo(e._stereo):e._pos&&t.pos(e._pos[0],e._pos[1],e._pos[2],e._id)}),Sound.prototype.reset=(n=Sound.prototype.reset,function(){var e=this,t=e._parent;return e._orientation=t._orientation,e._stereo=t._stereo,e._pos=t._pos,e._pannerAttr=t._pannerAttr,e._stereo?t.stereo(e._stereo):e._pos?t.pos(e._pos[0],e._pos[1],e._pos[2],e._id):e._panner&&(e._panner.disconnect(0),e._panner=void 0,t._refreshBuffer(e)),n.call(this)});var n,o,r,u=function(e,t){"spatial"===(t=t||"spatial")?(e._panner=Howler.ctx.createPanner(),e._panner.coneInnerAngle=e._pannerAttr.coneInnerAngle,e._panner.coneOuterAngle=e._pannerAttr.coneOuterAngle,e._panner.coneOuterGain=e._pannerAttr.coneOuterGain,e._panner.distanceModel=e._pannerAttr.distanceModel,e._panner.maxDistance=e._pannerAttr.maxDistance,e._panner.refDistance=e._pannerAttr.refDistance,e._panner.rolloffFactor=e._pannerAttr.rolloffFactor,e._panner.panningModel=e._pannerAttr.panningModel,void 0!==e._panner.positionX?(e._panner.positionX.setValueAtTime(e._pos[0],Howler.ctx.currentTime),e._panner.positionY.setValueAtTime(e._pos[1],Howler.ctx.currentTime),e._panner.positionZ.setValueAtTime(e._pos[2],Howler.ctx.currentTime)):e._panner.setPosition(e._pos[0],e._pos[1],e._pos[2]),void 0!==e._panner.orientationX?(e._panner.orientationX.setValueAtTime(e._orientation[0],Howler.ctx.currentTime),e._panner.orientationY.setValueAtTime(e._orientation[1],Howler.ctx.currentTime),e._panner.orientationZ.setValueAtTime(e._orientation[2],Howler.ctx.currentTime)):e._panner.setOrientation(e._orientation[0],e._orientation[1],e._orientation[2])):(e._panner=Howler.ctx.createStereoPanner(),e._panner.pan.setValueAtTime(e._stereo,Howler.ctx.currentTime)),e._panner.connect(e._node),e._paused||e._parent.pause(e._id,!0).play(e._id,!0)}}();const Cookies={get(e){var n=e+"=";let t=decodeURIComponent(document.cookie);var o=t.split(";");for(let t=0;t<o.length;t++){let e=o[t];for(;" "==e.charAt(0);)e=e.substring(1);if(0==e.indexOf(n))return e.substring(n.length,e.length)}return""},set(e,t,n){let o=new Date;o.setTime(o.getTime()+24*n*60*60*1e3*365);n="expires="+o.toUTCString();document.cookie=e+"="+t+";"+n+";path=/"}},Vec2={add(e,t){return{x:e.x+t.x,y:e.y+t.y}},subtract(e,t){return{x:e.x-t.x,y:e.y-t.y}},dotProduct(e,t){return e.x*t.x+e.y*t.y},applyDirVec(e,t,n){return{x:e.x+t*n.x,y:e.y+t*n.y}},getAngle(e,t){var n=e.x*t.x+e.y*t.y,e=e.x*t.y-e.y*t.x;return 180*Math.atan2(e,n)/Math.PI},getReflectionVector(e,t){t=this.normalize(t);var n=this.dotProduct(e,t);return{x:e.x-2*n*t.x,y:e.y-2*n*t.y}},normalize(e){var t=Math.sqrt(e.x*e.x+e.y*e.y);return{x:e.x/t,y:e.y/t}},abs(e){return Math.sqrt(e.x*e.x+e.y*e.y)},rotate(e,t){var t=t*Math.PI/180,n=Math.cos(t),t=Math.sin(t);return{x:e.x*n-e.y*t,y:e.x*t+e.y*n}},getReflectionVectorAdvanced(e,t,n,o){n=PMath.getRelativePlayerBallIntersectOffset(e,t,n,o),o=Vec2.getReflectionVector(t.velocity,Vec2.subtract(e[1],e[0])),t=Vec2.rotate(o,45*-n),o=Vec2.subtract(e[2],e[1]),n=Vec2.getAngle(o,t);return 160<n&&Vec2.rotate(t,-(n-160)),n<20&&Vec2.rotate(t,-(n-20)),t}},PMath={getBallPolygonVertices(e,t,n=1){var t=t.radius/Math.cos(Math.PI/e.length),o=PMath.getPolygonSideLength(e.length,.5);return this.getPolygonVertices(e.length,t*=o,n)},getPlayerRectVertices(o,e=1){let r=[];var i=this.getPolygonVertices(o.length,.5,e);for(let n=0;n<o.length;n++){let e,t;var s={x:-(t=n==o.length-1?(e=i[n],Vec2.subtract(i[0],i[n])):(e=i[n],Vec2.subtract(i[n+1],i[n]))).y,y:t.x},a=Vec2.applyDirVec(e,o[n].position,t),c=Vec2.applyDirVec(a,o[n].width/2,s),a=Vec2.applyDirVec(a,-o[n].width/2,s),s=Vec2.applyDirVec(c,o[n].size,t),u=Vec2.applyDirVec(a,o[n].size,t);r.push(c,a,u,s)}return r},getPolygonVertices(t,n,o=1){let r=[];for(let e=0;e<t;e++)r.push({x:n*Math.cos(2*Math.PI*e/t)*o+o/2,y:n*Math.sin(2*Math.PI*e/t)*o+o/2});return r},getPolygonSideLength(e,t,n=1){var o={x:t*Math.cos(2*Math.PI*0/e)*n+n/2,y:t*Math.sin(2*Math.PI*0/e)*n+n/2},t={x:t*Math.cos(2*Math.PI*1/e)*n+n/2,y:t*Math.sin(2*Math.PI*1/e)*n+n/2};return this.getDistanceBetweenPoints(o,t)},getPolygonSideDistance(e,t,n=1){return Math.sqrt(Math.pow(e*n,2)-Math.pow(this.getPolygonSideLength(t,e,n)/2,2))},getDistanceBetweenPoints(e,t){var n=e.x-t.x,e=e.y-t.y;return Math.sqrt(n*n+e*e)},getPlayerToBottomRotationAngle(e,t){let n=PMath.getPolygonVertices(t,.5,1),o=[];e==t-1?(o.push(n[e]),o.push(n[0])):o=n.slice(e,e+2);t=Vec2.subtract(o[0],o[1]),e=Vec2.subtract({x:1,y:0},{x:0,y:0});return Vec2.getAngle(t,e)},getRelativePlayerBallIntersectOffset(e,t,n,o){n=PMath.getPlayerToBottomRotationAngle(n,o),o={x:e[1].x,y:e[1].y},e={x:e[2].x,y:e[2].y},o=this.rotatePointAroundPivot({x:.5,y:.5},n,o),e=this.rotatePointAroundPivot({x:.5,y:.5},n,e),t={x:t.position.x,y:t.position.y},n=this.rotatePointAroundPivot({x:.5,y:.5},n,t),t=e<o?e:o;return(n.x-t.x)/((e<o?o:e).x-t.x)-.5},rotatePointAroundPivot(e,t,n){t*=Math.PI/180;var o=Math.sin(t),t=Math.cos(t),r=(n.x-=e.x,n.y-=e.y,n.x*t-n.y*o),o=n.x*o+n.y*t;return n.x=r+e.x,n.y=o+e.y,n}},Objects={clone(e){if(null==e||"object"!=typeof e)return e;if(e instanceof Array){for(var t=[],n=0,o=e.length;n<o;n++)t[n]=this.clone(e[n]);return t}if(e instanceof Object){var r,t={};for(r in e)e.hasOwnProperty(r)&&(t[r]=this.clone(e[r]));return t}throw new Error("Unable to copy obj! Its type isn't supported.")}},Collision={areLinesIntersecting:(e,t,n,o)=>{var r=(t.x-e.x)*(o.y-n.y)-(t.y-e.y)*(o.x-n.x),o=(e.y-n.y)*(o.x-n.x)-(e.x-n.x)*(o.y-n.y),n=(e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y);if(0==r)return 0==o&&0==n;t=o/r,e=n/r;return 0<=t&&t<=1&&0<=e&&e<=1},areCircleLineIntersectingPredictive(e,t,n){if(this.areCircleLineIntersecting(e.x1,e.x2,e.y1,e.y2,t.x,t.y,t.radius))return!0;var o={x:e.x1,y:e.y1},e={x:e.x2,y:e.y2},t={x:t.x,y:t.y},n={x:n.x,y:n.y};return!!this.areLinesIntersecting(o,e,t,n)},areCircleLineIntersecting(e,t,n,o,r,i,l){var s=t-e,a=o-n,c=((r-e)*s+(i-n)*a)/(s*s+a*a);let u,d;d=c<0?(u=e,n):1<c?(u=t,o):(u=e+c*s,n+c*a);t=r-u,o=i-d;return Math.sqrt(t*t+o*o)<=l},areCircleRectIntersectingPredictive:(e,t,n,o)=>{if(Collision.areCircleRectIntersecting(e[0],e[1],e[2],e[3],n.x,n.y,n.radius))return!0;for(let e=0;e<t.length;e++){var r=e==t.length-1?t[0]:t[e+1];if(Collision.areLinesIntersecting(t[e],r,{x:n.x,y:n.y},{x:o.x,y:o.y}))return!0}return!1},areCircleRectIntersecting:(e,t,n,o,r,i,s)=>Collision.arePointRectIntersecting(e,t,n,o,{x:r,y:i})||Collision.areCircleLineIntersecting(e.x,t.x,e.y,t.y,r,i,s)||Collision.areCircleLineIntersecting(t.x,n.x,t.y,n.y,r,i,s)||Collision.areCircleLineIntersecting(n.x,o.x,n.y,o.y,r,i,s)||Collision.areCircleLineIntersecting(o.x,e.x,o.y,e.y,r,i,s),arePointRectIntersecting:(e,t,n,o,r)=>{var i=Vec2.subtract(e,t),e=Vec2.subtract(e,r),n=Vec2.subtract(t,n),t=Vec2.subtract(t,r),r=Vec2.dotProduct(i,e),e=Vec2.dotProduct(i,i),i=Vec2.dotProduct(n,t),t=Vec2.dotProduct(n,n);return 0<=r&&r<=e&&0<=i&&i<=t}};class Game{constructor(){this.runData=null,this.playerSpeed=.02}update(e){null!=this.runData&&(this.checkCollisions(e),this.applyVelocities(e))}applyVelocities(n){this.runData.players.forEach((e,t)=>{e.position+=.02*e.velocity*n,1<e.position+e.size&&(e.position=1-e.size),e.position<0&&(e.position=0)}),this.runData.balls.forEach(e=>{e.position.x+=e.velocity.x*n,e.position.y+=e.velocity.y*n})}checkCollisions(o){var r=PMath.getPolygonVertices(this.runData.players.length,.5,1);let i=PMath.getPlayerRectVertices(this.runData.players,1),s=Objects.clone(this.runData.players),p=(s.forEach(e=>{e.position+=.02*e.velocity*o}),PMath.getPlayerRectVertices(s,1));for(let e=0;e<this.runData.balls.length;e++){let t=this.runData.balls[e];var a=PMath.getPolygonSideLength(this.runData.players.length,.5),c={x:t.position.x,y:t.position.y,radius:t.radius*a},u={x:t.position.x+t.velocity.x*o,y:t.position.y+t.velocity.y*o,radius:t.radius*a};let n=!1;for(let e=0;e<i.length;e+=4){var l=i.slice(e,e+4),f=p.slice(e,e+4);if(Collision.areCircleRectIntersectingPredictive(l,f,c,u)&&(n=!0,t.lastCollision!=e/4))return t.velocity=Vec2.getReflectionVectorAdvanced(l,t,e/4,s.length),void(t.lastCollision=e/4)}n||(t.lastCollision=null);for(let e=0;e<r.length;e++){var d=r[e],h=e==r.length-1?r[0]:r[e+1],d={x1:d.x,y1:d.y,x2:h.x,y2:h.y};if(Collision.areCircleLineIntersectingPredictive(d,c,u))return t.position.x=.5,void(t.position.y=.5)}(t.position.x<0||1<t.position.x||t.position.y<0||1<t.position.y)&&(t.position.x=.5,t.position.y=.5)}}}class SoundManager{constructor(){this.currentlyPlaying=null,this.sounds=[]}play(e){}}class NetworkManager{constructor(){this.socket=io(),this.init()}init(){this.socket.on("createResult",this.createResultHandler),this.socket.on("joinResult",this.joinResultHandler),this.socket.on("runData",this.runDataHandler),this.socket.on("leaveResult",this.leaveResultHandler),this.socket.on("changeNameResult",this.changeNameResultHandler)}sendInput(e){this.socket.emit("input",e)}joinGame(e){this.socket.emit("join",e)}joinResultHandler(e){ui.joinGameResult(e)}leaveGame(){this.socket.emit("leave")}leaveResultHandler(e){}changeName(e){this.socket.emit("changeName",e)}changeNameResultHandler(e){ui.changeNameResult(e)}createGame(e){this.socket.emit("create",e)}createResultHandler(e){ui.hostGameResult(e)}runDataHandler(e){game.runData=e}}class Renderer{constructor(e){this.canvas=document.getElementById(e),this.ctx=this.canvas.getContext("2d"),window.addEventListener("resize",this.resize.bind(this)),this.resize(),this.clearColor="black",this.backgroundImage=document.querySelector("#background"),this.ballParticleEmitters=[]}render(e){var t;this.ctx.fillStyle=this.clearColor,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),null!=e&&(this.ctx.drawImage(this.backgroundImage,0,0,this.canvas.width,this.canvas.height),e.players.length%2!=0&&(t=(.5+.5*Math.cos(Math.PI/e.players.length))*this.size,t=(this.size-t)/2,this.ctx.translate(0,t)),t=e.players.indexOf(e.players.find(e=>"you"==e.pID)),t=PMath.getPlayerToBottomRotationAngle(t,e.players.length),this.rotateCanvas(t),this.drawMap(e.players.length),this.drawBalls(e),this.drawPlayers(e.players),this.ctx.setTransform(1,0,0,1,0,0))}drawMap(e){var t=PMath.getPolygonVertices(e,.5,this.size);this.ctx.strokeStyle="#fff",this.ctx.beginPath(),this.ctx.moveTo(t[0].x,t[0].y);for(let e=1;e<t.length;e++)this.ctx.lineTo(t[e].x,t[e].y);this.ctx.lineTo(t[0].x,t[0].y),this.ctx.stroke(),this.ctx.closePath(),this.ctx.strokeStyle="#000",this.ctx.globalAlpha=.8,this.ctx.beginPath(),this.ctx.moveTo(t[0].x,t[0].y);for(let e=1;e<t.length;e++)this.ctx.lineTo(t[e].x,t[e].y);this.ctx.lineTo(t[0].x,t[0].y),this.ctx.fill(),this.ctx.closePath(),this.ctx.globalAlpha=1}drawBalls(e){let o=e.balls;for(let n=0;n<o.length;n++){let t=PMath.getBallPolygonVertices(e.players,o[n],this.size);t.forEach(e=>{e.x+=(o[n].position.x-.5)*this.size,e.y+=(o[n].position.y-.5)*this.size}),this.ctx.fillStyle="#fff",this.ctx.beginPath(),this.ctx.moveTo(t[0].x,t[0].y);for(let e=1;e<t.length;e++)this.ctx.lineTo(t[e].x,t[e].y);if(this.ctx.lineTo(t[0].x,t[0].y),this.ctx.closePath(),o.length<this.ballParticleEmitters.length&&this.ballParticleEmitters.splice(o.length,this.ballParticleEmitters.length-o.length),o.length>this.ballParticleEmitters.length)for(let e=this.ballParticleEmitters.length;e<o.length;e++)this.ballParticleEmitters.push(new ParticleEmitter(document.querySelector("canvas"),{particleLifeTime:50,maxParticles:100,particleSizeStart:15,particleSizeEnd:1,particleColorStart:{r:0,g:255,b:255,a:255},particleColorEnd:{r:0,g:0,b:255,a:255},particleSpeedStart:1,particleSpeedEnd:1,particleDirection:0,particleSpread:100,emitterSize:0,emitterSpeed:1,emitterPosition:{x:-300,y:-300}}));var r=Vec2.getAngle({x:0,y:-1},e.balls[n].velocity),i=PMath.getPolygonSideLength(e.players.length,.5);this.ballParticleEmitters[n].particleSizeStart=game.runData.balls[n].radius*this.size*i,this.ballParticleEmitters[n].particleDirection=r+180,this.ballParticleEmitters[n].emitterPosition={x:game.runData.balls[n].position.x*this.size,y:game.runData.balls[n].position.y*this.size},this.ballParticleEmitters[n].update(),this.ballParticleEmitters[n].draw()}}drawPlayers(e){this.ctx.fillStyle="#fff";var t=PMath.getPlayerRectVertices(e,this.size);for(let e=0;e<t.length;e+=4)this.drawRect(t[e],t[e+1],t[e+2],t[e+3])}resize(){var e=Math.min(window.innerWidth,window.innerHeight);this.canvas.width=e,this.canvas.height=e,this.size=e}rotateCanvas(e){this.ctx.translate(this.canvas.width/2,this.canvas.height/2),this.ctx.rotate(e*Math.PI/180),this.ctx.translate(-this.canvas.width/2,-this.canvas.height/2)}drawRect(e,t,n,o,r){this.ctx.fillStyle=r,this.ctx.beginPath(),this.ctx.moveTo(e.x,e.y),this.ctx.lineTo(t.x,t.y),this.ctx.lineTo(n.x,n.y),this.ctx.lineTo(o.x,o.y),this.ctx.lineTo(e.x,e.y),this.ctx.fill(),this.ctx.closePath()}}document.addEventListener("keydown",e=>keyDownHandler(e)),document.addEventListener("keyup",keyUpHandler);let dirKeys=[];function keyDownHandler(e){null!=game.runData&&("a"!=e.key||dirKeys.includes("a")?"d"!=e.key||dirKeys.includes("d")||(dirKeys.push("d"),net.sendInput("d"),game.runData.players.find(e=>"you"==e.pID).velocity=-1):(dirKeys.push("a"),net.sendInput("a"),game.runData.players.find(e=>"you"==e.pID).velocity=1))}function keyUpHandler(e){if(null!=game.runData)if("a"==e.key){if(dirKeys.splice(dirKeys.indexOf("a"),1),0==dirKeys.length)return net.sendInput("n"),void(game.runData.players.find(e=>"you"==e.pID).velocity=0);net.sendInput(dirKeys[0])}else if("d"==e.key){if(dirKeys.splice(dirKeys.indexOf("d"),1),0==dirKeys.length)return net.sendInput("n"),void(game.runData.players.find(e=>"you"==e.pID).velocity=0);net.sendInput(dirKeys[0])}}class UI{constructor(){this.hostBtn=document.querySelector(".btn-host"),this.joinBtn=document.querySelector(".btn-join"),this.joinInput=document.querySelector(".input-join"),this.backBtn=document.querySelector(".btn-back"),this.gameStatusText=document.querySelector(".game-status-text"),this.canvasContainer=document.querySelector(".canvas-container"),this.pregameUIContainer=document.querySelector(".pregame-ui-container"),this.setLandingState()}setLandingState(){this.hostBtn.style.display="inline",this.joinInput.style.display="none",this.joinBtn.style.margin="0 5vw 0 5vw",this.backBtn.style.display="none",this.gameStatusText.style.visibility="hidden",this.joinBtn.innerHTML="Join",this.hostBtn.innerHTML="Host",this.currentState="landing",this.backBtn.onclick=this.setLandingState.bind(this),this.hostBtn.onclick=this.setNameState.bind(this,"host"),this.joinBtn.onclick=this.setNameState.bind(this,"join")}setNameState(e){this.hostBtn.style.display="none",this.joinInput.style.display="inline",this.joinBtn.style.margin="0 5vw 0 0",this.backBtn.style.display="inline",this.joinInput.placeholder="Enter Username",this.joinInput.value=Cookies.get("username"),this.joinBtn.innerHTML="Submit",this.currentState="name-"+e,this.backBtn.onclick=this.setLandingState.bind(this),this.joinBtn.onclick=()=>net.changeName(this.joinInput.value)}setJoinState(){this.gameStatusText.style.visibility="hidden",Cookies.set("username",this.joinInput.value,1),this.hostBtn.style.display="none",this.joinInput.style.display="inline",this.joinBtn.style.margin="0 5vw 0 0",this.backBtn.style.display="inline",this.joinInput.placeholder="Enter room code",this.joinInput.value="",this.joinBtn.innerHTML="Join",this.currentState="join",this.backBtn.onclick=this.setLandingState.bind(this),this.joinBtn.onclick=()=>net.joinGame(this.joinInput.value)}setHostState(){this.gameStatusText.style.visibility="hidden",Cookies.set("username",this.joinInput.value,1),this.hostBtn.style.display="none",this.joinInput.style.display="inline",this.joinBtn.style.margin="0 5vw 0 0",this.backBtn.style.display="inline",this.joinInput.placeholder="Enter Lobby Name",this.joinInput.value="",this.joinBtn.innerHTML="Host",this.currentState="host",this.backBtn.onclick=this.setLandingState.bind(this),this.joinBtn.onclick=()=>net.createGame(this.joinInput.value)}setLobbyState(){this.pregameUIContainer.style.display="none",this.canvasContainer.style.display="grid",this.currentState="lobby"}changeNameResult(e){if(this.gameStatusText.style.visibility="hidden",!e.successful)return this.gameStatusText.innerHTML=e.reason,void(this.gameStatusText.style.visibility="visible");"name-join"==this.currentState?this.setJoinState():"name-host"==this.currentState&&this.setHostState()}joinGameResult(e){if(!e.successful)return this.gameStatusText.innerHTML=e.reason,void(this.gameStatusText.style.visibility="visible");this.setLobbyState()}hostGameResult(e){if(!e.successful)return this.gameStatusText.innerHTML=e.reason,void(this.gameStatusText.style.visibility="visible");this.setLobbyState()}}const net=new NetworkManager,renderer=new Renderer("canvas"),ui=new UI,game=new Game,sound=new SoundManager;let lastTime=Date.now();function loop(){requestAnimationFrame(loop);var e=Date.now(),t=e-lastTime,e=(lastTime=e,t/(1e3/60));game.update(e),renderer.render(game.runData),renderer.ctx.fillStyle="red",renderer.ctx.font="20px Arial",renderer.ctx.fillText(Math.floor(1e3/t),10,20)}loop();})();